<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2024-10-12T12:24:56-04:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Jesse Cambon</title><subtitle>Musings on data and open source software</subtitle><author><name>Jesse Cambon</name><email>jesse.cambon@gmail.com</email></author><entry><title type="html">Planning a PC Build</title><link href="http://localhost:4000/2024/10/12/2024-XX-XX-pc-build-part-1.html" rel="alternate" type="text/html" title="Planning a PC Build" /><published>2024-10-12T00:00:00-04:00</published><updated>2024-10-12T00:00:00-04:00</updated><id>http://localhost:4000/2024/10/12/2024-XX-XX-pc-build-part-1</id><content type="html" xml:base="http://localhost:4000/2024/10/12/2024-XX-XX-pc-build-part-1.html"><![CDATA[<p>Earlier this year I built a so called “Small Form Factor” (SFF) PC. As the name suggests, these PCs priorize a smaller footprint and portibility compared to the typical more bulky desktops most people are familiar with. Browsing the popular <a href="https://www.reddit.com/r/sffpc/">r/sffpc</a> you can see people showing off their SFF builds.</p>

<p>My build is not nearly as flashy or involved as many of the posts you’ll find on that subreddit, but it was a fun project and I’ve been happy with the results. I thought I would write up a blog post describing the process of planning this build. This isn’t intended to be a comprehensive guide on PC building, but you can refer to the references at the bottom for more guidance.</p>

<!-- insert picture of build -->

<p>I have almost exclusively used laptops in recent years and was unaware that building a desktop into such a small package was even possible. Laptops are conveniant and portable, but tend to have less powerful components and offer less flexibility with component selection and upgrades. For instance, the life of a desktop can often be extended with upgrades to the CPU, memory, or video card - often not possible with laptops. SFF PCs offer a compelling alternative if you want some of the advantages of a desktop without the extra bulk.</p>

<p>The PC I built is designed so that I can easily move it from one room to another. I could potentially even put it in a case or backpack and travel with it, but I don’t see myself doing that in the near future. I had four purposes in mind when building the PC:</p>

<ol>
  <li>Typical PC gaming (connected to a monitor and usually using mouse and keyboard)</li>
  <li>“Console-style” gaming (connected to a TV and using a controller)</li>
  <li>Machine Learning work (Pytorch, Transformers)</li>
  <li>Photo editing</li>
</ol>

<p>All four of these use cases benefit from GPU (graphics card) acceleration so the graphics card was a priority. I also from the beginning planned to exclusively use Linux on the PC, which caused me to priotize an AMD graphics card for their driver support. People do use Nvidia graphics cards on Linux, but the driver support for AMD cards has historically been better from what I could tell.</p>

<h3 id="planning">Planning</h3>

<p>The first step in building a PC is to decide what you want to use it for and what your priorities are. For instance, a PC that is built for high performance gaming will likely require quite different components to PC intended for photo editing. Prioritizing a powerful graphics card makes sense for machine learning or gaming, but it may offer little benefit if the applications you intend to use don’t heavily utilize graphics cards.</p>

<ul>
  <li>What types of applications are you going to use it for?</li>
  <li>What is your budget?</li>
  <li>Does it need to be small and portable?</li>
  <li>Is reducing fan noise a priority?</li>
</ul>

<h3 id="picking-components">Picking Components</h3>

<p><a href="https://pcpartpicker.com/list/NFjtdH">PCPartPicker Part List</a></p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Type</th>
      <th style="text-align: left">Item</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>Case</strong></td>
      <td style="text-align: left"><a href="https://pcpartpicker.com/product/BtxRsY/placeholder">S300 - Mini-ITX PC Gaming Case - Front I/O USB 3.0 Type - C Port - SFX Power Supply 100-130mm -Cable Management System - luminum Mini-ITX Motherboard Small Portable PC Case (PCIe 3.0 16X Rise</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Power Supply</strong></td>
      <td style="text-align: left"><a href="https://pcpartpicker.com/product/nJrmP6/corsair-sf750-2018-750-w-80-platinum-certified-fully-modular-sfx-power-supply-cp-9020186-na">Corsair SF750 (2018) 750 W 80+ Platinum Certified Fully Modular SFX Power Supply</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Video Card</strong></td>
      <td style="text-align: left"><a href="https://pcpartpicker.com/product/TxTZxr/sapphire-pulse-radeon-rx-7700-xt-12-gb-video-card-11335-04-20g">Sapphire PULSE Radeon RX 7700 XT 12 GB Video Card</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>CPU</strong></td>
      <td style="text-align: left"><a href="https://pcpartpicker.com/product/yXmmP6/amd-ryzen-5-7600-38-ghz-6-core-processor-100-100001015box">AMD Ryzen 5 7600 3.8 GHz 6-Core Processor</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>CPU Cooler</strong></td>
      <td style="text-align: left"><a href="https://pcpartpicker.com/product/7pjBD3/id-cooling-is-55-black-546-cfm-cpu-cooler-is-55-black">ID-COOLING IS-55 Black 54.6 CFM CPU Cooler</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Motherboard</strong></td>
      <td style="text-align: left"><a href="https://pcpartpicker.com/product/zQhv6h/asrock-a620i-lightning-wifi-mini-itx-am5-motherboard-a620i-lightning-wifi">ASRock A620I LIGHTNING WIFI Mini ITX AM5 Motherboard</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Wifi Adapter</strong></td>
      <td style="text-align: left"><a href="https://pcpartpicker.com/product/khhFf7/placeholder">Intel AX210 IEEE 802.11ax Bluetooth 5.2 Tri Band Wi-Fi/Bluetooth Combo Adapter for Notebook</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Memory</strong></td>
      <td style="text-align: left"><a href="https://pcpartpicker.com/product/LBstt6/gskill-flare-x5-32-gb-2-x-16-gb-ddr5-6000-cl30-memory-f5-6000j3038f16gx2-fx5">G.Skill Flare X5 32 GB (2 x 16 GB) DDR5-6000 CL30 Memory</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Storage</strong></td>
      <td style="text-align: left"><a href="https://pcpartpicker.com/product/yGTp99/sk-hynix-platinum-p41-2-tb-m2-2280-pcie-40-x4-nvme-solid-state-drive-shpp41-2000gm-2">SK Hynix Platinum P41 2 TB M.2-2280 PCIe 4.0 X4 NVME Solid State Drive</a></td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>Case Fan</strong></td>
      <td style="text-align: left"><a href="https://pcpartpicker.com/product/FM3mP6/noctua-nf-a12x15-pwm-chromaxblackswap-5544-cfm-120-mm-fan-nf-a12x15-pwm-chromaxblackswap">Noctua A12x15 PWM chromax.black.swap 55.44 CFM 120 mm Fan</a></td>
    </tr>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: left">Generated by <a href="https://pcpartpicker.com">PCPartPicker</a> 2024-10-12 11:32 EDT-0400</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>I selected the S300 case as it was a relatively inexpensive option (~$100) for a small (~8 Liter). Except for the front panel, the entire case is perforated metal so the airflow is quite good and helps keep components cooler than they otherwise would be in such a small case. I also considered the even smaller Velka 3 case, but this would have been more expensive, more of a process to build in, and greatly limited my options for graphics cards and CPU coolers. Two of the biggest considerations in an SFF build are the dimensions of CPU coolers and graphics cards that will fit in the case.</li>
  <li>The Ryzen 7600 CPU was selected for power efficiency.</li>
  <li>The 7700 XT GPU was a good value graphics card at the time of purchase. It outperforms the more expensive 4060 Ti from Nvidia.</li>
  <li>The ID-55 CPU cooler was the biggest cooler I could fit in this case. I also considered the AXP90-53 copper, but there were reports of difficulties mounting it on my motherboard of choice. I ended up swapping out the fan on the cooler for a quieter 12x120 mm Noctua fan, but this isn’t necessary if you aren’t too particular about fan noise.</li>
  <li>The Asrock A620i is one of the cheapest AM5 mini-itx motherboards around and it met all the requirements I needed.</li>
</ul>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://www.youtube.com/watch?v=s1fxZ-VWs2U">How to Build A PC (Linus Tech Tips)</a>. Very comprehensive video on all the steps of a PC build.</li>
  <li><a href="https://pcpartpicker.com/">PC Part Picker</a>. Great resource for hardware compatibility checks on hardware and also looking at other builds that people have done.</li>
  <li><a href="https://bestvaluegpu.com/">Best Value GPU</a> - Track the best performance per dollar GPUs based on current prices</li>
  <li><a href="https://www.techpowerup.com/">TechPowerUp.com</a> - great detailed reviews of graphics cards and other products (ex. <a href="https://www.techpowerup.com/gpu-specs/radeon-rx-7700-xt.c3911">RX 7700 XT Review</a>)</li>
  <li><a href="https://caseend.com/">Case End</a> - detailed specs on PC cases</li>
  <li>Useful Subreddits:
    <ul>
      <li><a href="https://www.reddit.com/r/buildapc/">r/buildapc</a></li>
      <li><a href="https://www.reddit.com/r/buildmeapc/">r/buildmeapc</a></li>
      <li><a href="https://www.reddit.com/r/sffpc/">r/sffpc</a> - For small form factor (SFF) builds</li>
      <li><a href="https://www.reddit.com/r/pcmasterrace/">r/pcmasterrace</a></li>
    </ul>
  </li>
</ul>

<p>Youtube build videos are a great resource. I used the following video as a guide for my build: <a href="https://www.youtube.com/watch?v=3BguJvWsyaM">S300 build $880 Lunchbox Gaming PC (1080p Destroyer)</a>.</p>

<ul>
  <li><a href="https://www.youtube.com/watch?v=rVP9kyrK7zk">Building a Mid Range Gaming ITX PC doesn’t have to be difficult - Featuring S300 ITX case</a></li>
  <li><a href="https://www.youtube.com/watch?v=0ypr8DxLKAE">Don’t Tell Big Rig Bros: This All AMD Small Foot Print Mini PC SLAYS AAA Games!</a></li>
</ul>]]></content><author><name>Jesse Cambon</name><email>jesse.cambon@gmail.com</email></author><category term="draft" /><summary type="html"><![CDATA[Earlier this year I built a so called “Small Form Factor” (SFF) PC. As the name suggests, these PCs priorize a smaller footprint and portibility compared to the typical more bulky desktops most people are familiar with. Browsing the popular r/sffpc you can see people showing off their SFF builds.]]></summary></entry><entry><title type="html">How to Create An R Package</title><link href="http://localhost:4000/2024/08/06/2019-11-creating-an-r-package.html" rel="alternate" type="text/html" title="How to Create An R Package" /><published>2024-08-06T22:20:10-04:00</published><updated>2024-08-06T22:20:10-04:00</updated><id>http://localhost:4000/2024/08/06/2019-11-creating-an-r-package</id><content type="html" xml:base="http://localhost:4000/2024/08/06/2019-11-creating-an-r-package.html"><![CDATA[<p>I recently created <a href="https://github.com/jessecambon/tidygeocoder">my first R package</a> because I wanted to have a simple way to use geocoding services like the US Census in R. Creating an R package can seem like a daunting task. ….</p>

<p>If you have written functions in R that would be useful others in the R community, a great way to share this work is with an R package. Thanks to some helpful developer tools, the process of creating and publishing an R package can be much easier than it might seem.</p>

<h3 id="getting-started">Getting Started</h3>
<ul>
  <li><a href="https://rstudio.com/products/rstudio/">Install R-Studio</a></li>
  <li>We will be generating our documentation with <a href="https://cran.rstudio.com/web/packages/roxygen2/index.html">roxygen2</a>. This will allow us to generate all of our <code class="language-plaintext highlighter-rouge">man</code> documentation from embedded coments in our <code class="language-plaintext highlighter-rouge">R</code> code files.</li>
</ul>

<h3 id="file-layout">File Layout</h3>

<h5 id="important-files">Important Files</h5>
<ul>
  <li><code class="language-plaintext highlighter-rouge">DESCRIPTION</code>: Contains important infornation about your package such as dependencies, author info, and your license.</li>
  <li><code class="language-plaintext highlighter-rouge">.Rbuildignore</code>: list files and folders you do not want to include in your R package. Include files and directories that aren’t part of the standard R package format such as <code class="language-plaintext highlighter-rouge">/data-raw</code> and <code class="language-plaintext highlighter-rouge">/README.md</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">projectname.Rproj</code> : RStudio project file. Don’t lose this.</li>
</ul>

<h5 id="main-folders">Main Folders</h5>
<ul>
  <li><code class="language-plaintext highlighter-rouge">R</code>: store your R code here.</li>
  <li><code class="language-plaintext highlighter-rouge">data</code>: datasets will be stored here. If you have scripts and data sources that you use to create this data, save them in a separate <code class="language-plaintext highlighter-rouge">data-raw</code> folder and then be sure to add this directory to your <code class="language-plaintext highlighter-rouge">.Rbuildignore</code> file.</li>
  <li><code class="language-plaintext highlighter-rouge">man</code>: Documentation generated by <code class="language-plaintext highlighter-rouge">roxygen2</code> with embedded content in your <code class="language-plaintext highlighter-rouge">R</code> code files.</li>
  <li><code class="language-plaintext highlighter-rouge">tests</code>: Use the <a href="https://testthat.r-lib.org/">testthat</a> library to create functional tests for your package. Some properly written and easy to run tests will help give you some peace of mind that your latest bugfix hasn’t broken some other part of the package.</li>
  <li><code class="language-plaintext highlighter-rouge">vignettes</code>: vignettes are short examples that demonstrate the functionality of your package. Create a <code class="language-plaintext highlighter-rouge">.Rmd</code> in this directory to create one.</li>
</ul>

<h3 id="resources">Resources</h3>
<ul>
  <li>General Instructions: http://r-pkgs.had.co.nz/</li>
  <li>More general instructions: https://rstats-pkgs.readthedocs.io</li>
  <li><a href="https://cran.r-project.org/web/packages/roxygen2/">roxygen2</a></li>
  <li><a href="https://testthat.r-lib.org/">testthat</a></li>
  <li><a href="https://www.rstudio.com/wp-content/uploads/2015/03/devtools-cheatsheet.pdf">Devtools cheat sheet</a>
*</li>
</ul>]]></content><author><name>Jesse Cambon</name><email>jesse.cambon@gmail.com</email></author><category term="draft" /><summary type="html"><![CDATA[I recently created my first R package because I wanted to have a simple way to use geocoding services like the US Census in R. Creating an R package can seem like a daunting task. ….]]></summary></entry><entry><title type="html">Job Market</title><link href="http://localhost:4000/2022/06/26/2022-XX-XX-job-market.html" rel="alternate" type="text/html" title="Job Market" /><published>2022-06-26T00:00:00-04:00</published><updated>2022-06-26T00:00:00-04:00</updated><id>http://localhost:4000/2022/06/26/2022-XX-XX-job-market</id><content type="html" xml:base="http://localhost:4000/2022/06/26/2022-XX-XX-job-market.html"><![CDATA[<h2 id="intro">Intro</h2>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

<p><img src="/../images/godzilla-tech-interview.jpg" alt="Alt text goes here" /></p>

<p>Source: <a href="https://www.reddit.com/r/recruitinghell/comments/l6bp24/interview_level_godzilla_job_pays_10_hr/">Reddit</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_diabetes</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_diabetes</span><span class="p">(</span><span class="n">return_X_y</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">as_frame</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

<span class="n">sns</span><span class="p">.</span><span class="n">displot</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">"bmi"</span><span class="p">,</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="s">'kde'</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.FacetGrid at 0x7fd82f16d7f0&gt;
</code></pre></div></div>

<p><img src="/jupyter_files/2022-XX-XX-job-market_files/2022-XX-XX-job-market_4_1.png" alt="png" /></p>]]></content><author><name>Jesse Cambon</name></author><category term="rants" /><summary type="html"><![CDATA[Intro]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/images/tidygeocoder_hex.png" /><media:content medium="image" url="http://localhost:4000/images/tidygeocoder_hex.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Test Jupyter</title><link href="http://localhost:4000/2021/10/24/2021-XX-XX-sklearn.html" rel="alternate" type="text/html" title="Test Jupyter" /><published>2021-10-24T00:00:00-04:00</published><updated>2021-10-24T00:00:00-04:00</updated><id>http://localhost:4000/2021/10/24/2021-XX-XX-sklearn</id><content type="html" xml:base="http://localhost:4000/2021/10/24/2021-XX-XX-sklearn.html"><![CDATA[<h3 id="references">References</h3>

<ul>
  <li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_diabetes.html#sklearn.datasets.load_diabetes">Diabetes Dataset</a></li>
  <li><a href="https://scikit-learn.org/stable/auto_examples/ensemble/plot_gradient_boosting_regression.html#sphx-glr-auto-examples-ensemble-plot-gradient-boosting-regression-py">Gradient Boosted Regression Example</a></li>
  <li><a href="https://scikit-optimize.github.io/stable/auto_examples/sklearn-gridsearchcv-replacement.html">Bayesian Hyperparameter Search</a></li>
  <li><a href="https://scikit-optimize.github.io/stable/auto_examples/bayesian-optimization.html">Gaussian process explanation</a></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_diabetes</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span><span class="p">,</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">skopt</span> <span class="kn">import</span> <span class="n">BayesSearchCV</span>
<span class="kn">from</span> <span class="nn">skopt.plots</span> <span class="kn">import</span> <span class="n">plot_objective</span><span class="p">,</span> <span class="n">plot_histogram</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">yellowbrick.regressor</span> <span class="kn">import</span> <span class="n">residuals_plot</span><span class="p">,</span> <span class="n">prediction_error</span>

<span class="n">my_seed</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load dataset
</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_diabetes</span><span class="p">(</span><span class="n">return_X_y</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">as_frame</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

<span class="n">combi</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">n_features</span> <span class="o">=</span> <span class="n">X</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">combi</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>sex</th>
      <th>bmi</th>
      <th>bp</th>
      <th>s1</th>
      <th>s2</th>
      <th>s3</th>
      <th>s4</th>
      <th>s5</th>
      <th>s6</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.038076</td>
      <td>0.050680</td>
      <td>0.061696</td>
      <td>0.021872</td>
      <td>-0.044223</td>
      <td>-0.034821</td>
      <td>-0.043401</td>
      <td>-0.002592</td>
      <td>0.019908</td>
      <td>-0.017646</td>
      <td>151.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.001882</td>
      <td>-0.044642</td>
      <td>-0.051474</td>
      <td>-0.026328</td>
      <td>-0.008449</td>
      <td>-0.019163</td>
      <td>0.074412</td>
      <td>-0.039493</td>
      <td>-0.068330</td>
      <td>-0.092204</td>
      <td>75.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.085299</td>
      <td>0.050680</td>
      <td>0.044451</td>
      <td>-0.005671</td>
      <td>-0.045599</td>
      <td>-0.034194</td>
      <td>-0.032356</td>
      <td>-0.002592</td>
      <td>0.002864</td>
      <td>-0.025930</td>
      <td>141.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.089063</td>
      <td>-0.044642</td>
      <td>-0.011595</td>
      <td>-0.036656</td>
      <td>0.012191</td>
      <td>0.024991</td>
      <td>-0.036038</td>
      <td>0.034309</td>
      <td>0.022692</td>
      <td>-0.009362</td>
      <td>206.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.005383</td>
      <td>-0.044642</td>
      <td>-0.036385</td>
      <td>0.021872</td>
      <td>0.003935</td>
      <td>0.015596</td>
      <td>0.008142</td>
      <td>-0.002592</td>
      <td>-0.031991</td>
      <td>-0.046641</td>
      <td>135.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>437</th>
      <td>0.041708</td>
      <td>0.050680</td>
      <td>0.019662</td>
      <td>0.059744</td>
      <td>-0.005697</td>
      <td>-0.002566</td>
      <td>-0.028674</td>
      <td>-0.002592</td>
      <td>0.031193</td>
      <td>0.007207</td>
      <td>178.0</td>
    </tr>
    <tr>
      <th>438</th>
      <td>-0.005515</td>
      <td>0.050680</td>
      <td>-0.015906</td>
      <td>-0.067642</td>
      <td>0.049341</td>
      <td>0.079165</td>
      <td>-0.028674</td>
      <td>0.034309</td>
      <td>-0.018118</td>
      <td>0.044485</td>
      <td>104.0</td>
    </tr>
    <tr>
      <th>439</th>
      <td>0.041708</td>
      <td>0.050680</td>
      <td>-0.015906</td>
      <td>0.017282</td>
      <td>-0.037344</td>
      <td>-0.013840</td>
      <td>-0.024993</td>
      <td>-0.011080</td>
      <td>-0.046879</td>
      <td>0.015491</td>
      <td>132.0</td>
    </tr>
    <tr>
      <th>440</th>
      <td>-0.045472</td>
      <td>-0.044642</td>
      <td>0.039062</td>
      <td>0.001215</td>
      <td>0.016318</td>
      <td>0.015283</td>
      <td>-0.028674</td>
      <td>0.026560</td>
      <td>0.044528</td>
      <td>-0.025930</td>
      <td>220.0</td>
    </tr>
    <tr>
      <th>441</th>
      <td>-0.045472</td>
      <td>-0.044642</td>
      <td>-0.073030</td>
      <td>-0.081414</td>
      <td>0.083740</td>
      <td>0.027809</td>
      <td>0.173816</td>
      <td>-0.039493</td>
      <td>-0.004220</td>
      <td>0.003064</td>
      <td>57.0</td>
    </tr>
  </tbody>
</table>
<p>442 rows × 11 columns</p>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># CV split
</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="n">my_seed</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>sex</th>
      <th>bmi</th>
      <th>bp</th>
      <th>s1</th>
      <th>s2</th>
      <th>s3</th>
      <th>s4</th>
      <th>s5</th>
      <th>s6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>160</th>
      <td>-0.009147</td>
      <td>-0.044642</td>
      <td>-0.062252</td>
      <td>-0.074528</td>
      <td>-0.023584</td>
      <td>-0.013214</td>
      <td>0.004460</td>
      <td>-0.039493</td>
      <td>-0.035817</td>
      <td>-0.046641</td>
    </tr>
    <tr>
      <th>80</th>
      <td>0.070769</td>
      <td>-0.044642</td>
      <td>0.012117</td>
      <td>0.042530</td>
      <td>0.071357</td>
      <td>0.053487</td>
      <td>0.052322</td>
      <td>-0.002592</td>
      <td>0.025393</td>
      <td>-0.005220</td>
    </tr>
    <tr>
      <th>334</th>
      <td>-0.060003</td>
      <td>0.050680</td>
      <td>-0.047163</td>
      <td>-0.022885</td>
      <td>-0.071743</td>
      <td>-0.057681</td>
      <td>-0.006584</td>
      <td>-0.039493</td>
      <td>-0.062913</td>
      <td>-0.054925</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>169    152.0
302    198.0
162    172.0
Name: target, dtype: float64
</code></pre></div></div>

<h2 id="eda">EDA</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">[</span><span class="s">'sex'</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-0.044642    235
 0.050680    207
Name: sex, dtype: int64
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="n">displot</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">"bmi"</span><span class="p">,</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="s">'kde'</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.FacetGrid at 0x7f1becbf4c90&gt;
</code></pre></div></div>

<p><img src="/jupyter_files/2021-XX-XX-sklearn_files/2021-XX-XX-sklearn_10_1.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="n">displot</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">"bp"</span><span class="p">,</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="s">'kde'</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.FacetGrid at 0x7f1c2c05d890&gt;
</code></pre></div></div>

<p><img src="/jupyter_files/2021-XX-XX-sklearn_files/2021-XX-XX-sklearn_11_1.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="n">displot</span><span class="p">(</span>
    <span class="n">combi</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">"bmi"</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s">"target"</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.FacetGrid at 0x7f1be14dab90&gt;
</code></pre></div></div>

<p><img src="/jupyter_files/2021-XX-XX-sklearn_files/2021-XX-XX-sklearn_12_1.png" alt="png" /></p>

<h2 id="model">Model</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="n">my_seed</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># model pipelines
</span><span class="n">pipelines</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'linear regression'</span> <span class="p">:</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">LinearRegression</span><span class="p">()),</span>
    <span class="s">'gradient boosting'</span> <span class="p">:</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">GradientBoostingRegressor</span><span class="p">()),</span>
    <span class="s">'random forest'</span> <span class="p">:</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Search gradient boosted model hyperparameter space for optimal parameters using scikit-opt</p>

<p>https://scikit-optimize.github.io/stable/auto_examples/hyperparameter-optimization.html#sphx-glr-auto-examples-hyperparameter-optimization-py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># NOTE: Had to downgrade to scikit-learn 0.23.2 to avoid an error regarding 'iid':
# pip install -Iv scikit-learn==0.23.2
</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">BayesSearchCV</span><span class="p">(</span>
    <span class="n">pipelines</span><span class="p">[</span><span class="s">'gradient boosting'</span><span class="p">],</span>
    <span class="p">{</span>

    <span class="s">"gradientboostingregressor__min_samples_split"</span> <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
<span class="c1">#    "gradientboostingregressor__min_samples_leaf" : (1, 20),   
</span>    <span class="s">"gradientboostingregressor__n_estimators"</span> <span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
    <span class="s">"gradientboostingregressor__max_depth"</span> <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="s">"gradientboostingregressor__max_features"</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_features</span><span class="p">),</span>
    <span class="s">"gradientboostingregressor__learning_rate"</span> <span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s">'log-uniform'</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">kf</span><span class="p">,</span> <span class="c1"># use k-fold cross validation
</span>    <span class="n">random_state</span> <span class="o">=</span> <span class="n">my_seed</span><span class="p">,</span>
    <span class="n">n_iter</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">n_jobs</span> <span class="o">=</span> <span class="mi">8</span>
<span class="p">)</span>

<span class="n">opt</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"val. score: %s"</span> <span class="o">%</span> <span class="n">opt</span><span class="p">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"test score: %s"</span> <span class="o">%</span> <span class="n">opt</span><span class="p">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"best params: %s"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">best_params_</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)
/home/cambonator/anaconda3/lib/python3.7/site-packages/sklearn/model_selection/_split.py:672: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  % (min_groups, self.n_splits)), UserWarning)


val. score: 0.41534121914268674
test score: 0.5780905566781522
best params: OrderedDict([('gradientboostingregressor__learning_rate', 0.03200464817593894), ('gradientboostingregressor__max_depth', 1), ('gradientboostingregressor__max_features', 10), ('gradientboostingregressor__min_samples_split', 2), ('gradientboostingregressor__n_estimators', 300)])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_</span> <span class="o">=</span> <span class="n">plot_objective</span><span class="p">(</span>
    <span class="n">opt</span><span class="p">.</span><span class="n">optimizer_results_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/jupyter_files/2021-XX-XX-sklearn_files/2021-XX-XX-sklearn_18_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">10</span><span class="o">**</span><span class="mi">0</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_</span> <span class="o">=</span> <span class="n">plot_histogram</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">optimizer_results_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/jupyter_files/2021-XX-XX-sklearn_files/2021-XX-XX-sklearn_20_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#from skopt.plots import plot_convergence
#plot_convergence(opt)
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_</span> <span class="o">=</span> <span class="n">prediction_error</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/jupyter_files/2021-XX-XX-sklearn_files/2021-XX-XX-sklearn_22_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_</span> <span class="o">=</span> <span class="n">prediction_error</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/jupyter_files/2021-XX-XX-sklearn_files/2021-XX-XX-sklearn_23_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_</span> <span class="o">=</span> <span class="n">residuals_plot</span><span class="p">(</span>
    <span class="n">opt</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="/jupyter_files/2021-XX-XX-sklearn_files/2021-XX-XX-sklearn_24_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_</span> <span class="o">=</span> <span class="n">residuals_plot</span><span class="p">(</span>
    <span class="n">opt</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span>
<span class="p">)</span>
</code></pre></div></div>

<p><img src="/jupyter_files/2021-XX-XX-sklearn_files/2021-XX-XX-sklearn_25_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>]]></content><author><name>Jesse Cambon</name></author><category term="python" /><summary type="html"><![CDATA[References]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/images/tidygeocoder_hex.png" /><media:content medium="image" url="http://localhost:4000/images/tidygeocoder_hex.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Tidygeocoder 1.0.4</title><link href="http://localhost:4000/2021/10/17/tidygeocoder-1-0-4.html" rel="alternate" type="text/html" title="Tidygeocoder 1.0.4" /><published>2021-10-17T00:00:00-04:00</published><updated>2021-10-17T00:00:00-04:00</updated><id>http://localhost:4000/2021/10/17/tidygeocoder-1-0-4</id><content type="html" xml:base="http://localhost:4000/2021/10/17/tidygeocoder-1-0-4.html"><![CDATA[<p><a href="https://jessecambon.github.io/tidygeocoder/">Tidygeocoder v1.0.4</a> is released! 🍾 This release adds support for the <a href="https://www.geoapify.com/geocoding-api">Geoapify geocoding service</a> (thanks <a href="https://github.com/dpprdan">Daniel Possenriede</a>!), a progress bar, more helpful console output, and new functions for combining the results of multiple geocoding queries. A more detailed overview of the changes in this release is available in the <a href="https://jessecambon.github.io/tidygeocoder/news/index.html">changelog</a>.</p>

<h3 id="progress-bars-and-console-output">Progress Bars and Console Output</h3>

<p>Progress bars are now displayed for single input geocoding queries (ie. not batch queries). Additionally, console messages now by default show which geocoding service was used, how many addresses or coordinates were given to it, and how long the query took to execute.</p>

<p><img src="/../images/tidygeocoder_progress_bar_v104.gif" width="70%" style="display: block; margin: auto;" /></p>

<p>The <code class="language-plaintext highlighter-rouge">progress_bar</code> parameter can be used to toggle the use of the progress bar while the <code class="language-plaintext highlighter-rouge">quiet</code> parameter can be used to silence console messages that are displayed by default. See the documentation for <a href="https://jessecambon.github.io/tidygeocoder/reference/geo.html">geo()</a> or <a href="https://jessecambon.github.io/tidygeocoder/reference/reverse_geo.html">reverse_geo()</a> for details.</p>

<p>Additionally, the <code class="language-plaintext highlighter-rouge">quiet</code>, <code class="language-plaintext highlighter-rouge">progress_bar</code>, and <code class="language-plaintext highlighter-rouge">verbose</code> parameters can now be set permanently via <code class="language-plaintext highlighter-rouge">options()</code>. For example, <code class="language-plaintext highlighter-rouge">options(tidygeocoder.progress_bar = FALSE)</code> will disable progress bars for all queries.</p>

<h3 id="combining-multiple-queries">Combining Multiple Queries</h3>

<p>In past releases of the package, <code class="language-plaintext highlighter-rouge">method = "cascade"</code> could be used in the <code class="language-plaintext highlighter-rouge">geo()</code> and <code class="language-plaintext highlighter-rouge">geocode()</code> functions to combine the results of geocoding queries from two different services. The “cascade” method is now deprecated in favor of two new and more flexible functions: <code class="language-plaintext highlighter-rouge">geocode_combine()</code> and <code class="language-plaintext highlighter-rouge">geo_combine()</code>. These functions allow for executing and combining the results of more than two queries and they allow the queries to be fully customized.</p>

<p>To demonstrate the utility of these new functions, below I’ve assembled a dataset of addresses to be geocoded. The first 5 are street level addresses in the United States that can be geocoded with the US Census geocoding service. However, three of these addresses will not return results with the US Census <em>batch</em> service (see <a href="https://github.com/jessecambon/tidygeocoder/issues/87">issue #87</a> for more information) and must instead be geocoded with the US Census single address geocoder. Also, the last three addresses are cities outside the United States and require a different geocoding service entirely (the US Census service is limited to the United States).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidygeocoder</span><span class="p">)</span><span class="w">

</span><span class="n">mixed_addresses</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tribble</span><span class="p">(</span><span class="w">
  </span><span class="o">~</span><span class="n">street_address</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">state_cd</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">zip_cd</span><span class="p">,</span><span class="w">
  </span><span class="s2">"624 W DAVIS ST #1D"</span><span class="p">,</span><span class="w">   </span><span class="s2">"BURLINGTON"</span><span class="p">,</span><span class="w"> </span><span class="s2">"NC"</span><span class="p">,</span><span class="w">  </span><span class="m">27215</span><span class="p">,</span><span class="w">
  </span><span class="s2">"201 E CENTER ST #268"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MEBANE"</span><span class="p">,</span><span class="w">     </span><span class="s2">"NC"</span><span class="p">,</span><span class="w">  </span><span class="m">27302</span><span class="p">,</span><span class="w">
  </span><span class="s2">"7833  WOLFE LN"</span><span class="p">,</span><span class="w">       </span><span class="s2">"SNOW CAMP"</span><span class="p">,</span><span class="w">  </span><span class="s2">"NC"</span><span class="p">,</span><span class="w">  </span><span class="m">27349</span><span class="p">,</span><span class="w">
  </span><span class="s2">"202 C St"</span><span class="p">,</span><span class="w">             </span><span class="s2">"San Diego"</span><span class="p">,</span><span class="w">  </span><span class="s2">"CA"</span><span class="p">,</span><span class="w">  </span><span class="m">92101</span><span class="p">,</span><span class="w">
  </span><span class="s2">"121 N Rouse Ave"</span><span class="p">,</span><span class="w">      </span><span class="s2">"Bozeman"</span><span class="p">,</span><span class="w">    </span><span class="s2">"MT"</span><span class="p">,</span><span class="w">  </span><span class="m">59715</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">bind_rows</span><span class="p">(</span><span class="w">
    </span><span class="n">tibble</span><span class="p">(</span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'Taipei'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Moscow'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Buenos Aires'</span><span class="p">))</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>If we wanted to geocode a large dataset with addresses such as these, we might first try to geocode as many as possible via the US Census batch service, then attempt the remaining addresses with the US Census single address geocoder, and then finally send any remaining unfound addresses to another service. We’ll accomplish this workflow in the code below.</p>

<p>The <code class="language-plaintext highlighter-rouge">geocode_combine()</code> function accepts a dataframe input and a list of queries provided as lists (ie. a list of lists). Each list in the <code class="language-plaintext highlighter-rouge">queries</code> argument contains parameters that are passed to the <code class="language-plaintext highlighter-rouge">geocode()</code> function. Optionally, the <code class="language-plaintext highlighter-rouge">query_names</code> argument can be used to specify a label to be used for each query’s results.</p>

<p>Below, the <code class="language-plaintext highlighter-rouge">street</code>, <code class="language-plaintext highlighter-rouge">city</code>, <code class="language-plaintext highlighter-rouge">state</code>, and <code class="language-plaintext highlighter-rouge">postalcode</code> arguments are specified for the first two queries while the <code class="language-plaintext highlighter-rouge">address</code> argument (ie. single line address) is pointed at the <code class="language-plaintext highlighter-rouge">city</code> column for the third query (the ArcGIS service only accepts a single line address argument and doesn’t use address component arguments like <code class="language-plaintext highlighter-rouge">city</code> and <code class="language-plaintext highlighter-rouge">state</code>).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mixed_addresses</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">geocode_combine</span><span class="p">(</span><span class="w">
    </span><span class="n">queries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
      </span><span class="nf">list</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'census'</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'batch'</span><span class="p">,</span><span class="w"> 
        </span><span class="n">street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'street_address'</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'city'</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'state_cd'</span><span class="p">,</span><span class="w"> </span><span class="n">postalcode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'zip_cd'</span><span class="p">),</span><span class="w">
      </span><span class="nf">list</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'census'</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'single'</span><span class="p">,</span><span class="w">
           </span><span class="n">street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'street_address'</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'city'</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'state_cd'</span><span class="p">,</span><span class="w"> </span><span class="n">postalcode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'zip_cd'</span><span class="p">),</span><span class="w">
      </span><span class="nf">list</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'arcgis'</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'city'</span><span class="p">)</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">query_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'census - batch'</span><span class="p">,</span><span class="w"> </span><span class="s1">'census - single'</span><span class="p">,</span><span class="w"> </span><span class="s1">'arcgis'</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 

## Passing 8 addresses to the US Census batch geocoder

## Query completed in: 1.9 seconds

## Passing 6 addresses to the US Census single address geocoder

## Query completed in: 3.6 seconds

## Passing 3 addresses to the ArcGIS single address geocoder

## Query completed in: 1.4 seconds
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">street_address</th>
      <th style="text-align: left">city</th>
      <th style="text-align: left">state_cd</th>
      <th style="text-align: right">zip_cd</th>
      <th style="text-align: right">lat</th>
      <th style="text-align: right">long</th>
      <th style="text-align: left">query</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">624 W DAVIS ST #1D</td>
      <td style="text-align: left">BURLINGTON</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: right">27215</td>
      <td style="text-align: right">36.09598</td>
      <td style="text-align: right">-79.44453</td>
      <td style="text-align: left">census - single</td>
    </tr>
    <tr>
      <td style="text-align: left">201 E CENTER ST #268</td>
      <td style="text-align: left">MEBANE</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: right">27302</td>
      <td style="text-align: right">36.09683</td>
      <td style="text-align: right">-79.26977</td>
      <td style="text-align: left">census - single</td>
    </tr>
    <tr>
      <td style="text-align: left">7833 WOLFE LN</td>
      <td style="text-align: left">SNOW CAMP</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: right">27349</td>
      <td style="text-align: right">35.89866</td>
      <td style="text-align: right">-79.43713</td>
      <td style="text-align: left">census - single</td>
    </tr>
    <tr>
      <td style="text-align: left">202 C St</td>
      <td style="text-align: left">San Diego</td>
      <td style="text-align: left">CA</td>
      <td style="text-align: right">92101</td>
      <td style="text-align: right">32.71676</td>
      <td style="text-align: right">-117.16283</td>
      <td style="text-align: left">census - batch</td>
    </tr>
    <tr>
      <td style="text-align: left">121 N Rouse Ave</td>
      <td style="text-align: left">Bozeman</td>
      <td style="text-align: left">MT</td>
      <td style="text-align: right">59715</td>
      <td style="text-align: right">45.68066</td>
      <td style="text-align: right">-111.03203</td>
      <td style="text-align: left">census - batch</td>
    </tr>
    <tr>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">Taipei</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">25.03737</td>
      <td style="text-align: right">121.56355</td>
      <td style="text-align: left">arcgis</td>
    </tr>
    <tr>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">55.75696</td>
      <td style="text-align: right">37.61502</td>
      <td style="text-align: left">arcgis</td>
    </tr>
    <tr>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">Buenos Aires</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">-34.60849</td>
      <td style="text-align: right">-58.37344</td>
      <td style="text-align: left">arcgis</td>
    </tr>
  </tbody>
</table>

<p>By default the results of the queries are combined into a single dataframe as shown above and the <code class="language-plaintext highlighter-rouge">query</code> column shows which query produced each result. Alternatively, the results of each query can be returned as separate dataframes in a list by using <code class="language-plaintext highlighter-rouge">return_list = TRUE</code>.</p>

<p>By default, only addresses that are not found in a query are passed to the subsequent query. However, setting <code class="language-plaintext highlighter-rouge">cascade = FALSE</code> will pass all addresses to all queries. See <a href="https://jessecambon.github.io/tidygeocoder/reference/geocode_combine.html">the documentation for the geocode_combine() function</a> for more usage details.</p>

<h3 id="package-housekeeping">Package Housekeeping</h3>

<p>The <code class="language-plaintext highlighter-rouge">return_type</code>, <code class="language-plaintext highlighter-rouge">geocodio_v</code>, <code class="language-plaintext highlighter-rouge">mapbox_permanent</code>, <code class="language-plaintext highlighter-rouge">mapquest_open</code>, <code class="language-plaintext highlighter-rouge">iq_region</code>, and <code class="language-plaintext highlighter-rouge">here_request_id</code> parameters are now <em>deprecated</em> in favor of the new <code class="language-plaintext highlighter-rouge">api_options</code> parameter. For instance, instead of using <code class="language-plaintext highlighter-rouge">return_type = "geographies"</code> you should now instead use <code class="language-plaintext highlighter-rouge">api_options = list(census_return_type = "geographies")</code>.</p>

<p>Also, the <code class="language-plaintext highlighter-rouge">cascade_order</code>, <code class="language-plaintext highlighter-rouge">param_error</code>, and <code class="language-plaintext highlighter-rouge">batch_limit_error</code> parameters in <code class="language-plaintext highlighter-rouge">geo()</code> are now deprecated as they were only required because of the deprecated “cascade” method. Refer to the documentation for <a href="https://jessecambon.github.io/tidygeocoder/reference/geo.html">geo()</a> or <a href="https://jessecambon.github.io/tidygeocoder/reference/reverse_geo.html">reverse_geo()</a> for details.</p>]]></content><author><name>Jesse Cambon</name></author><category term="r" /><category term="tidygeocoder" /><summary type="html"><![CDATA[Tidygeocoder v1.0.4 is released! 🍾 This release adds support for the Geoapify geocoding service (thanks Daniel Possenriede!), a progress bar, more helpful console output, and new functions for combining the results of multiple geocoding queries. A more detailed overview of the changes in this release is available in the changelog.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/images/tidygeocoder_hex_dark2021.png" /><media:content medium="image" url="http://localhost:4000/images/tidygeocoder_hex_dark2021.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Tidygeocoder 1.0.3</title><link href="http://localhost:4000/2021/04/19/tidygeocoder-1-0-3.html" rel="alternate" type="text/html" title="Tidygeocoder 1.0.3" /><published>2021-04-19T00:00:00-04:00</published><updated>2021-04-19T00:00:00-04:00</updated><id>http://localhost:4000/2021/04/19/tidygeocoder-1-0-3</id><content type="html" xml:base="http://localhost:4000/2021/04/19/tidygeocoder-1-0-3.html"><![CDATA[<p><a href="https://jessecambon.github.io/tidygeocoder/">Tidygeocoder v1.0.3</a> is released on <a href="https://cran.r-project.org/package=tidygeocoder">CRAN</a>! This release adds support for reverse geocoding (geocoding geographic coordinates) and 7 new geocoder services: <a href="https://opencagedata.com/">OpenCage</a>, <a href="https://developer.here.com/products/geocoding-and-search">HERE</a>, <a href="https://docs.mapbox.com/api/search/">Mapbox</a>, <a href="https://developer.mapquest.com/documentation/geocoding-api/">MapQuest</a>, <a href="https://developer.tomtom.com/search-api/search-api-documentation/geocoding">TomTom</a>, <a href="https://docs.microsoft.com/en-us/bingmaps/rest-services/locations/">Bing</a>, and <a href="https://developers.arcgis.com/rest/geocode/api-reference/overview-world-geocoding-service.htm">ArcGIS</a>. Refer to the <a href="https://jessecambon.github.io/tidygeocoder/articles/geocoder_services.html">geocoder services page</a> for information on all the supported geocoder services.</p>

<p>Big thanks go to <a href="https://github.com/dieghernan">Diego Hernangómez</a> and <a href="https://github.com/dpprdan">Daniel Possenriede</a> for their work on this release. You can refer to the <a href="https://jessecambon.github.io/tidygeocoder/news/index.html">changelog</a> for the details on the changes in the release.</p>

<h2 id="reverse-geocoding">Reverse Geocoding</h2>

<p>In this example we’ll randomly sample coordinates in Madrid and label them on a map. The coordinates are placed in a dataframe and reverse geocoded with the <code class="language-plaintext highlighter-rouge">reverse_geocode()</code> function. The Nominatim (“osm”) geocoder service is used and several API parameters are passed via the <code class="language-plaintext highlighter-rouge">custom_query</code> argument to request additional columns of data from Nominatim. Refer to <a href="https://nominatim.org/release-docs/latest/api/Reverse/">Nominatim’s API documentation</a> for more information on these parameters.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">,</span><span class="w"> </span><span class="n">warn.conflicts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidygeocoder</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">leaflet</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">glue</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">htmltools</span><span class="p">)</span><span class="w">

</span><span class="n">num_coords</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="c1"># number of coordinates</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">103</span><span class="p">)</span><span class="w"> </span><span class="c1"># for reproducibility</span><span class="w">

</span><span class="c1"># latitude and longitude bounds</span><span class="w">
</span><span class="n">lat_limits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">40.40857</span><span class="p">,</span><span class="w"> </span><span class="m">40.42585</span><span class="p">)</span><span class="w">
</span><span class="n">long_limits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-3.72472</span><span class="p">,</span><span class="w"> </span><span class="m">-3.66983</span><span class="p">)</span><span class="w">

</span><span class="c1"># randomly sample latitudes and longitude values</span><span class="w">
</span><span class="n">random_lats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="w">
  </span><span class="n">num_coords</span><span class="p">,</span><span class="w"> 
  </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat_limits</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> 
  </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat_limits</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
  </span><span class="p">)</span><span class="w">

</span><span class="n">random_longs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="w">
  </span><span class="n">num_coords</span><span class="p">,</span><span class="w"> 
  </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">long_limits</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> 
  </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">long_limits</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
  </span><span class="p">)</span><span class="w">

</span><span class="c1"># Reverse geocode the coordinates</span><span class="w">
</span><span class="c1"># the speed of the query is limited to 1 coordinate per second to comply</span><span class="w">
</span><span class="c1"># with Nominatim's usage policies</span><span class="w">
</span><span class="n">madrid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reverse_geo</span><span class="p">(</span><span class="w">
              </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">random_lats</span><span class="p">,</span><span class="w"> </span><span class="n">random_longs</span><span class="p">,</span><span class="w"> 
              </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'osm'</span><span class="p">,</span><span class="w"> </span><span class="n">full_results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
              </span><span class="n">custom_query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">extratags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">addressdetails</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">namedetails</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
          </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>After geocoding our coordinates, we can construct HTML labels with the data returned from Nominatim and display these locations on a <a href="http://rstudio.github.io/leaflet/">leaflet</a> map.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create html labels</span><span class="w">
</span><span class="c1"># https://rstudio.github.io/leaflet/popups.html</span><span class="w">
</span><span class="n">madrid_labelled</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">madrid</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">transmute</span><span class="p">(</span><span class="w">
    </span><span class="n">lat</span><span class="p">,</span><span class="w"> 
    </span><span class="n">long</span><span class="p">,</span><span class="w"> 
    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_c</span><span class="p">(</span><span class="w">
        </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"&lt;b&gt;Name&lt;/b&gt;: {name}&lt;/br&gt;"</span><span class="p">)),</span><span class="w">
        </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">suburb</span><span class="p">),</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"&lt;b&gt;Suburb&lt;/b&gt;: {suburb}&lt;/br&gt;"</span><span class="p">)),</span><span class="w">
        </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">quarter</span><span class="p">),</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"&lt;b&gt;Quarter&lt;/b&gt;: {quarter}"</span><span class="p">)),</span><span class="w">
        </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">htmltools</span><span class="o">::</span><span class="n">HTML</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">

</span><span class="c1"># Make the leaflet map</span><span class="w">
</span><span class="n">madrid_labelled</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">leaflet</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"100%"</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leafletOptions</span><span class="p">(</span><span class="n">attributionControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">setView</span><span class="p">(</span><span class="n">lng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">madrid</span><span class="o">$</span><span class="n">long</span><span class="p">),</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">madrid</span><span class="o">$</span><span class="n">lat</span><span class="p">),</span><span class="w"> </span><span class="n">zoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Map Backgrounds</span><span class="w">
  </span><span class="c1"># https://leaflet-extras.github.io/leaflet-providers/preview/</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="n">providers</span><span class="o">$</span><span class="n">Stamen.Terrain</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Terrain"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="n">providers</span><span class="o">$</span><span class="n">OpenRailwayMap</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Rail"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="n">providers</span><span class="o">$</span><span class="n">Esri.WorldImagery</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Satellite"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addTiles</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"OSM"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Add Markers</span><span class="w">
  </span><span class="n">addMarkers</span><span class="p">(</span><span class="w">
    </span><span class="n">labelOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labelOptions</span><span class="p">(</span><span class="n">noHide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">),</span><span class="w"> </span><span class="n">lng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">lat</span><span class="p">,</span><span class="w">
    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">label</span><span class="p">,</span><span class="w">
    </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Random Locations"</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Map Control Options</span><span class="w">
  </span><span class="n">addLayersControl</span><span class="p">(</span><span class="w">
    </span><span class="n">baseGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"OSM"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Terrain"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Satellite"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Rail"</span><span class="p">),</span><span class="w">
    </span><span class="n">overlayGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Random Locations"</span><span class="p">),</span><span class="w">
    </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">layersControlOptions</span><span class="p">(</span><span class="n">collapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div id="htmlwidget-562547e6d92361b7b630" style="width:100%;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-562547e6d92361b7b630">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"attributionControl":false},"setView":[[40.415021103152,-3.69357282582785],14,[]],"calls":[{"method":"addProviderTiles","args":["Stamen.Terrain",null,"Terrain",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenRailwayMap",null,"Rail",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satellite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"OSM",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[40.4123014709814,40.4096615445682,40.4175871664274,40.417272506227,40.4106519994937,40.4100781149822,40.4160619508378,40.411906436556,40.4091072090676,40.413993361209,40.4163817212981,40.4135176730348,40.4223178283641,40.4228223820305,40.423828380907,40.410822169486,40.4109466401929,40.4134973449898,40.4146834641808,40.4143576724255,40.4116045660791,40.4180861643726,40.4174389485912,40.4185510909274,40.4180497715706],[-3.67578744418699,-3.67010136934424,-3.67335474251329,-3.70310583343772,-3.67488869123186,-3.71444517586805,-3.67663930623259,-3.68756156697234,-3.72200196854039,-3.69475406050333,-3.67205522449481,-3.70229658222932,-3.6763332644197,-3.68158102478245,-3.72233264530065,-3.6795209595742,-3.68922342991826,-3.69160540612346,-3.6707955976882,-3.70259709061521,-3.7173106429264,-3.72088573588971,-3.69363431777976,-3.71829686008829,-3.70821170503502],null,null,"Random Locations",{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,["<b>Name<\/b>: Torre del Retiro<\/br><b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Niño Jesús","<b>Name<\/b>: Alimentación Bazar<\/br><b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Niño Jesús","<b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Ibiza","<b>Name<\/b>: Casa de Empeño<\/br><b>Suburb<\/b>: Sol<\/br><b>Quarter<\/b>: Sol","<b>Name<\/b>: Real Escuela Superior de Arte Dramático (RESAD)<\/br><b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Niño Jesús","<b>Name<\/b>: Dalieda de San Francisco<\/br><b>Suburb<\/b>: Palacio<\/br>","<b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Ibiza","<b>Name<\/b>: Bosque del Recuerdo<\/br><b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Jerónimos","<b>Suburb<\/b>: Latina<\/br>","<b>Suburb<\/b>: Cortes<\/br><b>Quarter<\/b>: Cortes","<b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Ibiza","<b>Suburb<\/b>: Embajadores<\/br>","<b>Suburb<\/b>: Salamanca<\/br><b>Quarter<\/b>: Goya","<b>Suburb<\/b>: Salamanca<\/br><b>Quarter<\/b>: Recoletos","<b>Suburb<\/b>: Moncloa-Aravaca<\/br>","<b>Name<\/b>: La Rosaleda<\/br><b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Jerónimos","<b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Jerónimos","<b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Jerónimos","<b>Name<\/b>: Citröen España<\/br><b>Suburb<\/b>: Retiro<\/br><b>Quarter<\/b>: Niño Jesús","<b>Name<\/b>: España Cañi<\/br><b>Suburb<\/b>: Cortes<\/br>","<b>Suburb<\/b>: Palacio<\/br><b>Quarter<\/b>: Palacio","<b>Name<\/b>: Paseo de la Virgen del Puerto<\/br><b>Suburb<\/b>: Palacio<\/br><b>Quarter<\/b>: Palacio","<b>Suburb<\/b>: Cortes<\/br><b>Quarter<\/b>: Cortes","<b>Suburb<\/b>: Moncloa-Aravaca<\/br><b>Quarter<\/b>: Argüelles","<b>Name<\/b>: Oratorio Santo Niño del Remedio<\/br><b>Suburb<\/b>: Centro<\/br>"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["OSM","Terrain","Satellite","Rail"],"Random Locations",{"collapsed":true,"autoZIndex":true,"position":"topright"}]}],"limits":{"lat":[40.4091072090676,40.423828380907],"lng":[-3.72233264530065,-3.67010136934424]}},"evals":[],"jsHooks":[]}</script>

<h2 id="limits">Limits</h2>

<p>This release also improves support for returning multiple results per input with the <code class="language-plaintext highlighter-rouge">limit</code> argument. Consider this batch query with the US Census geocoder:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tie_addresses</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="o">::</span><span class="n">tribble</span><span class="p">(</span><span class="w">
  </span><span class="o">~</span><span class="n">res_street_address</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">res_city_desc</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">state_cd</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">zip_code</span><span class="p">,</span><span class="w">
  </span><span class="s2">"624 W DAVIS ST   #1D"</span><span class="p">,</span><span class="w">   </span><span class="s2">"BURLINGTON"</span><span class="p">,</span><span class="w"> </span><span class="s2">"NC"</span><span class="p">,</span><span class="w">  </span><span class="m">27215</span><span class="p">,</span><span class="w">
  </span><span class="s2">"201 E CENTER ST   #268"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MEBANE"</span><span class="p">,</span><span class="w">     </span><span class="s2">"NC"</span><span class="p">,</span><span class="w">  </span><span class="m">27302</span><span class="p">,</span><span class="w">
  </span><span class="s2">"7833  WOLFE LN"</span><span class="p">,</span><span class="w">         </span><span class="s2">"SNOW CAMP"</span><span class="p">,</span><span class="w">  </span><span class="s2">"NC"</span><span class="p">,</span><span class="w">  </span><span class="m">27349</span><span class="p">,</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">tg_batch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tie_addresses</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">geocode</span><span class="p">(</span><span class="w">
    </span><span class="n">street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res_street_address</span><span class="p">,</span><span class="w">
    </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res_city_desc</span><span class="p">,</span><span class="w">
    </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_cd</span><span class="p">,</span><span class="w">
    </span><span class="n">postalcode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zip_code</span><span class="p">,</span><span class="w">
    </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'census'</span><span class="p">,</span><span class="w"> 
    </span><span class="n">full_results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">res_street_address</th>
      <th style="text-align: left">res_city_desc</th>
      <th style="text-align: left">state_cd</th>
      <th style="text-align: right">zip_code</th>
      <th style="text-align: right">lat</th>
      <th style="text-align: right">long</th>
      <th style="text-align: right">id</th>
      <th style="text-align: left">input_address</th>
      <th style="text-align: left">match_indicator</th>
      <th style="text-align: left">match_type</th>
      <th style="text-align: left">matched_address</th>
      <th style="text-align: left">tiger_line_id</th>
      <th style="text-align: left">tiger_side</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">624 W DAVIS ST #1D</td>
      <td style="text-align: left">BURLINGTON</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: right">27215</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">624 W DAVIS ST #1D, BURLINGTON, NC, 27215</td>
      <td style="text-align: left">Tie</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
    </tr>
    <tr>
      <td style="text-align: left">201 E CENTER ST #268</td>
      <td style="text-align: left">MEBANE</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: right">27302</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">2</td>
      <td style="text-align: left">201 E CENTER ST #268, MEBANE, NC, 27302</td>
      <td style="text-align: left">Tie</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
    </tr>
    <tr>
      <td style="text-align: left">7833 WOLFE LN</td>
      <td style="text-align: left">SNOW CAMP</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: right">27349</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">NA</td>
      <td style="text-align: right">3</td>
      <td style="text-align: left">7833 WOLFE LN, SNOW CAMP, NC, 27349</td>
      <td style="text-align: left">Tie</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
    </tr>
  </tbody>
</table>

<p>You can see NA results are returned and the <code class="language-plaintext highlighter-rouge">match_indicator</code> column indicates a “Tie”. This is what the US Census batch geocoder returns when multiple results are available for each input address (see <a href="https://github.com/jessecambon/tidygeocoder/issues/87">issue #87</a> for more details).</p>

<p>To see all available results for these addresses, you will need to use <code class="language-plaintext highlighter-rouge">mode</code> to force single address (not batch) geocoding and <code class="language-plaintext highlighter-rouge">limit &gt; 1</code>. The <code class="language-plaintext highlighter-rouge">return_input</code> argument (new in this release) has to be set to <code class="language-plaintext highlighter-rouge">FALSE</code> to allow <code class="language-plaintext highlighter-rouge">limit</code> to be set to a value other than 1. See the <a href="https://jessecambon.github.io/tidygeocoder/reference/geocode.html">geocode() function documentation</a> for details.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tg_single</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tie_addresses</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">geocode</span><span class="p">(</span><span class="w">
    </span><span class="n">street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res_street_address</span><span class="p">,</span><span class="w">
    </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res_city_desc</span><span class="p">,</span><span class="w">
    </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_cd</span><span class="p">,</span><span class="w">
    </span><span class="n">postalcode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zip_code</span><span class="p">,</span><span class="w">
    </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w">
    </span><span class="n">return_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
    </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'census'</span><span class="p">,</span><span class="w"> 
    </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'single'</span><span class="p">,</span><span class="w">
    </span><span class="n">full_results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">street</th>
      <th style="text-align: left">city</th>
      <th style="text-align: left">state</th>
      <th style="text-align: left">postalcode</th>
      <th style="text-align: right">lat</th>
      <th style="text-align: right">long</th>
      <th style="text-align: left">matchedAddress</th>
      <th style="text-align: left">tigerLine.tigerLineId</th>
      <th style="text-align: left">tigerLine.side</th>
      <th style="text-align: left">addressComponents.fromAddress</th>
      <th style="text-align: left">addressComponents.toAddress</th>
      <th style="text-align: left">addressComponents.preQualifier</th>
      <th style="text-align: left">addressComponents.preDirection</th>
      <th style="text-align: left">addressComponents.preType</th>
      <th style="text-align: left">addressComponents.streetName</th>
      <th style="text-align: left">addressComponents.suffixType</th>
      <th style="text-align: left">addressComponents.suffixDirection</th>
      <th style="text-align: left">addressComponents.suffixQualifier</th>
      <th style="text-align: left">addressComponents.city</th>
      <th style="text-align: left">addressComponents.state</th>
      <th style="text-align: left">addressComponents.zip</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">624 W DAVIS ST #1D</td>
      <td style="text-align: left">BURLINGTON</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27215</td>
      <td style="text-align: right">36.09598</td>
      <td style="text-align: right">-79.44453</td>
      <td style="text-align: left">624 W DAVIS ST, BURLINGTON, NC, 27215</td>
      <td style="text-align: left">71662708</td>
      <td style="text-align: left">L</td>
      <td style="text-align: left">618</td>
      <td style="text-align: left">628</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">W</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">DAVIS</td>
      <td style="text-align: left">ST</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">BURLINGTON</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27215</td>
    </tr>
    <tr>
      <td style="text-align: left">624 W DAVIS ST #1D</td>
      <td style="text-align: left">BURLINGTON</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27215</td>
      <td style="text-align: right">36.08821</td>
      <td style="text-align: right">-79.43201</td>
      <td style="text-align: left">624 E DAVIS ST, BURLINGTON, NC, 27215</td>
      <td style="text-align: left">71664000</td>
      <td style="text-align: left">L</td>
      <td style="text-align: left">600</td>
      <td style="text-align: left">698</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">E</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">DAVIS</td>
      <td style="text-align: left">ST</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">BURLINGTON</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27215</td>
    </tr>
    <tr>
      <td style="text-align: left">201 E CENTER ST #268</td>
      <td style="text-align: left">MEBANE</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27302</td>
      <td style="text-align: right">36.09683</td>
      <td style="text-align: right">-79.26977</td>
      <td style="text-align: left">201 W CENTER ST, MEBANE, NC, 27302</td>
      <td style="text-align: left">71655977</td>
      <td style="text-align: left">R</td>
      <td style="text-align: left">201</td>
      <td style="text-align: left">299</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">W</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">CENTER</td>
      <td style="text-align: left">ST</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">MEBANE</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27302</td>
    </tr>
    <tr>
      <td style="text-align: left">201 E CENTER ST #268</td>
      <td style="text-align: left">MEBANE</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27302</td>
      <td style="text-align: right">36.09582</td>
      <td style="text-align: right">-79.26624</td>
      <td style="text-align: left">201 E CENTER ST, MEBANE, NC, 27302</td>
      <td style="text-align: left">71656021</td>
      <td style="text-align: left">R</td>
      <td style="text-align: left">299</td>
      <td style="text-align: left">201</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">E</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">CENTER</td>
      <td style="text-align: left">ST</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">MEBANE</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27302</td>
    </tr>
    <tr>
      <td style="text-align: left">7833 WOLFE LN</td>
      <td style="text-align: left">SNOW CAMP</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27349</td>
      <td style="text-align: right">35.89866</td>
      <td style="text-align: right">-79.43713</td>
      <td style="text-align: left">7833 WOLFE LN, SNOW CAMP, NC, 27349</td>
      <td style="text-align: left">71682243</td>
      <td style="text-align: left">L</td>
      <td style="text-align: left">7999</td>
      <td style="text-align: left">7801</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">WOLFE</td>
      <td style="text-align: left">LN</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">SNOW CAMP</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27349</td>
    </tr>
    <tr>
      <td style="text-align: left">7833 WOLFE LN</td>
      <td style="text-align: left">SNOW CAMP</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27349</td>
      <td style="text-align: right">35.89693</td>
      <td style="text-align: right">-79.43707</td>
      <td style="text-align: left">7833 WOLF LN, SNOW CAMP, NC, 27349</td>
      <td style="text-align: left">71685327</td>
      <td style="text-align: left">L</td>
      <td style="text-align: left">7801</td>
      <td style="text-align: left">7911</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">WOLF</td>
      <td style="text-align: left">LN</td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left">SNOW CAMP</td>
      <td style="text-align: left">NC</td>
      <td style="text-align: left">27349</td>
    </tr>
  </tbody>
</table>

<p>We can now see there are two available results for each address. Note that this particular issue with “Tie” batch results is specific to the US Census geocoder service. Refer to the <a href="https://jessecambon.github.io/tidygeocoder/reference/api_parameter_reference.html">api_parameter_reference</a> documentation for more details on the <code class="language-plaintext highlighter-rouge">limit</code> parameter.</p>

<p>The <code class="language-plaintext highlighter-rouge">limit</code> parameter can also be used to return all matches for a more general query:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">paris</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">geo</span><span class="p">(</span><span class="s1">'Paris'</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'opencage'</span><span class="p">,</span><span class="w"> </span><span class="n">full_results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">address</th>
      <th style="text-align: right">lat</th>
      <th style="text-align: right">long</th>
      <th style="text-align: left">formatted</th>
      <th style="text-align: left">annotations.currency.name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Paris</td>
      <td style="text-align: right">48.85670</td>
      <td style="text-align: right">2.351462</td>
      <td style="text-align: left">Paris, France</td>
      <td style="text-align: left">Euro</td>
    </tr>
    <tr>
      <td style="text-align: left">Paris</td>
      <td style="text-align: right">33.66180</td>
      <td style="text-align: right">-95.555513</td>
      <td style="text-align: left">Paris, TX 75460, United States of America</td>
      <td style="text-align: left">United States Dollar</td>
    </tr>
    <tr>
      <td style="text-align: left">Paris</td>
      <td style="text-align: right">38.20980</td>
      <td style="text-align: right">-84.252987</td>
      <td style="text-align: left">Paris, Kentucky, United States of America</td>
      <td style="text-align: left">United States Dollar</td>
    </tr>
    <tr>
      <td style="text-align: left">Paris</td>
      <td style="text-align: right">36.30195</td>
      <td style="text-align: right">-88.325858</td>
      <td style="text-align: left">Paris, TN 38242, United States of America</td>
      <td style="text-align: left">United States Dollar</td>
    </tr>
    <tr>
      <td style="text-align: left">Paris</td>
      <td style="text-align: right">39.61115</td>
      <td style="text-align: right">-87.696137</td>
      <td style="text-align: left">Paris, IL 61944, United States of America</td>
      <td style="text-align: left">United States Dollar</td>
    </tr>
    <tr>
      <td style="text-align: left">Paris</td>
      <td style="text-align: right">44.25995</td>
      <td style="text-align: right">-70.500641</td>
      <td style="text-align: left">Paris, Maine, United States of America</td>
      <td style="text-align: left">United States Dollar</td>
    </tr>
    <tr>
      <td style="text-align: left">Paris</td>
      <td style="text-align: right">35.29203</td>
      <td style="text-align: right">-93.729917</td>
      <td style="text-align: left">Paris, AR 72855, United States of America</td>
      <td style="text-align: left">United States Dollar</td>
    </tr>
    <tr>
      <td style="text-align: left">Paris</td>
      <td style="text-align: right">39.48087</td>
      <td style="text-align: right">-92.001281</td>
      <td style="text-align: left">Paris, MO 65275, United States of America</td>
      <td style="text-align: left">United States Dollar</td>
    </tr>
  </tbody>
</table>

<p>The R Markdown file that generated this post is available <a href="https://github.com/jessecambon/jessecambon.github.io/blob/main/_posts/2021-04-19-tidygeocoder-1-0-3.Rmd">here</a>.</p>]]></content><author><name>Jesse Cambon</name></author><category term="r" /><category term="tidygeocoder" /><summary type="html"><![CDATA[Tidygeocoder v1.0.3 is released on CRAN! This release adds support for reverse geocoding (geocoding geographic coordinates) and 7 new geocoder services: OpenCage, HERE, Mapbox, MapQuest, TomTom, Bing, and ArcGIS. Refer to the geocoder services page for information on all the supported geocoder services.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/images/tidygeocoder_hex.png" /><media:content medium="image" url="http://localhost:4000/images/tidygeocoder_hex.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Tidygeocoder 1.0.2</title><link href="http://localhost:4000/2021/01/18/tidygeocoder-1-0-2.html" rel="alternate" type="text/html" title="Tidygeocoder 1.0.2" /><published>2021-01-18T00:00:00-05:00</published><updated>2021-01-18T00:00:00-05:00</updated><id>http://localhost:4000/2021/01/18/tidygeocoder-1-0-2</id><content type="html" xml:base="http://localhost:4000/2021/01/18/tidygeocoder-1-0-2.html"><![CDATA[<p><a href="https://jessecambon.github.io/tidygeocoder/index.html">Tidygeocoder v1.0.2</a> <em>“Yodeling Yak”</em> is now on <a href="https://cran.r-project.org/package=tidygeocoder">CRAN</a>. This release adds support for the popular <a href="https://developers.google.com/maps/documentation/javascript/geocoding">Google geocoder service</a> (thanks <a href="https://github.com/chris31415926535">@chris31415926535</a>) and also includes several bugfixes and enhancements. Refer to the <a href="https://jessecambon.github.io/tidygeocoder/news/index.html">changelog</a> for details on the release and to the <a href="https://jessecambon.github.io/tidygeocoder/#geocoder-services">tidygeocoder homepage</a> for a comparison of all supported geocoder services.</p>

<p><img src="/../images/google_map_pin.png" width="25%" style="display: block; margin: auto;" /></p>

<p>You can make use of the Google geocoder service by passing <code class="language-plaintext highlighter-rouge">method = 'google'</code> to the <a href="https://jessecambon.github.io/tidygeocoder/reference/geo.html"><code class="language-plaintext highlighter-rouge">geo()</code></a> and <a href="https://jessecambon.github.io/tidygeocoder/reference/geocode.html"><code class="language-plaintext highlighter-rouge">geocode()</code></a> functions. Note that the Google geocoder service requires registering for an API key and <a href="https://developers.google.com/maps/documentation/geocoding/usage-and-billing">charges per query</a>. The Google API key needs to be stored in the <code class="language-plaintext highlighter-rouge">GOOGLEGEOCODE_API_KEY</code> environmental variable for use with tidygeocoder.</p>

<p>Also new in this release, US Census batch geocoding results will now return geographic FIPs codes in character format (instead of numeric) to preserve leading zeros (<a href="https://github.com/jessecambon/tidygeocoder/issues/47">#47</a>). The <code class="language-plaintext highlighter-rouge">return_type = 'geographies'</code> query in the <a href="https://jessecambon.github.io/tidygeocoder/index.html#usage">usage example</a> shows the new data format.</p>

<p>Additionally, arguments passed to the <a href="https://jessecambon.github.io/tidygeocoder/reference/geo.html"><code class="language-plaintext highlighter-rouge">geo()</code></a> and <a href="https://jessecambon.github.io/tidygeocoder/reference/geocode.html"><code class="language-plaintext highlighter-rouge">geocode()</code></a> functions that aren’t valid for the selected geocoder service (ie. the Census geocoder doesn’t have a <code class="language-plaintext highlighter-rouge">country</code> argument) will now throw errors:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidygeocoder</span><span class="p">)</span><span class="w">

</span><span class="n">geo</span><span class="p">(</span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Auckland'</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'New Zealand'</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'census'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error in geo(city = "Auckland", country = "New Zealand", method = "census"): The following parameter(s) are not supported for the "census" method:
## 
## country
## 
## See ?api_parameter_reference for more details.
</code></pre></div></div>

<p>If you’re interested in contributing to the package and would like to add support for other geocoder services, updated instructions on how to go about this are <a href="https://github.com/jessecambon/tidygeocoder/issues/62#issue-777707424">located here</a>.</p>]]></content><author><name>Jesse Cambon</name></author><category term="r" /><category term="tidygeocoder" /><summary type="html"><![CDATA[Tidygeocoder v1.0.2 “Yodeling Yak” is now on CRAN. This release adds support for the popular Google geocoder service (thanks @chris31415926535) and also includes several bugfixes and enhancements. Refer to the changelog for details on the release and to the tidygeocoder homepage for a comparison of all supported geocoder services.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/images/google_map_pin.png" /><media:content medium="image" url="http://localhost:4000/images/google_map_pin.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Intro to HTML Presentations</title><link href="http://localhost:4000/2020/07/15/html-presentations.html" rel="alternate" type="text/html" title="Intro to HTML Presentations" /><published>2020-07-15T00:00:00-04:00</published><updated>2020-07-15T00:00:00-04:00</updated><id>http://localhost:4000/2020/07/15/html-presentations</id><content type="html" xml:base="http://localhost:4000/2020/07/15/html-presentations.html"><![CDATA[<!--

output: html_document


output: 
  md_document:
    pandoc_args: ["--wrap=none"]
    variant: gfm
    preserve_yaml: TRUE 

-->

<ul>
  <li><a href="https://github.com/jessecambon/jessecambon.github.io/blob/master/files/tidygeocoder-presentation/tidygeocoder-presentation.Rmd">Link to Code</a></li>
  <li><a href="https://jessecambon.github.io/files/tidygeocoder-presentation/tidygeocoder-presentation.html#1">Link to Presentation</a></li>
</ul>

<!-- end list -->

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">knitr</span><span class="o">::</span><span class="n">include_url</span><span class="p">(</span><span class="s1">'https://jessecambon.github.io/files/tidygeocoder-presentation/tidygeocoder-presentation.html#1'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="code">Code</h2>

<p>The top of the file is the <strong>YAML header</strong>.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">self_contained: false</code> - the HTML file will not be self-contained. I originally set this to true, but this made the HTML file slow to load and also made it less efficient to store on Github.</li>
  <li><code class="language-plaintext highlighter-rouge">scroll: false</code> - this prevents scrolling from changing the slide.</li>
  <li><code class="language-plaintext highlighter-rouge">css: xaringan-themer.css</code> - includes xaringanthemer CSS styles</li>
</ul>

<p>The following code relates to <strong>xaringanthemer</strong> which provides conveniant CSS styling for xaringan slides:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">custom_styles</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
  </span><span class="c1"># this is for the code that overflows on the slides (vertically)</span><span class="w">
  </span><span class="s2">".scroll-output"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s2">"max-height"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"480px"</span><span class="p">,</span><span class="w"> 
                      </span><span class="s2">"overflow-y"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"scroll"</span><span class="p">,</span><span class="w">
                      </span><span class="s2">"overflow-x"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'hide'</span><span class="p">))</span><span class="w">
                      
</span><span class="n">xaringanthemer</span><span class="o">::</span><span class="n">style_xaringan</span><span class="p">(</span><span class="w">
      </span><span class="n">base_font_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'16px'</span><span class="p">,</span><span class="w">
      </span><span class="n">title_slide_background_image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'images/tidygeocoder_hex.png'</span><span class="p">,</span><span class="w">
      </span><span class="n">title_slide_text_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'white'</span><span class="p">,</span><span class="w">
      </span><span class="n">title_slide_background_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'25%'</span><span class="p">,</span><span class="w">
      </span><span class="n">title_slide_background_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"50% 85%"</span><span class="p">,</span><span class="w">
      </span><span class="n">extra_css</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">custom_styles</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">extra_css</code> argument of <code class="language-plaintext highlighter-rouge">xaringanthemer::style_xaringan()</code> is used to create a new <code class="language-plaintext highlighter-rouge">.scroll-output</code> CSS class which is used to provide scrollable views of code (such as on <a href="https://jessecambon.github.io/files/tidygeocoder-presentation/tidygeocoder-presentation.html#15">slide 15</a>). The <code class="language-plaintext highlighter-rouge">title_slide_background_size</code> and <code class="language-plaintext highlighter-rouge">title_slide_background_position</code> arguments are used to position the <code class="language-plaintext highlighter-rouge">title_slide_background_image</code> on the title slide.</p>

<ul>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">.pull-left[]</code> and <code class="language-plaintext highlighter-rouge">.pull-right[]</code> declarations provide a coveniant layout for many slides.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">knitr::include_graphics()</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">knitr::include_url()</code></p>
  </li>
</ul>

<p>Different ways of controlling output size:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">fig.width</code>, <code class="language-plaintext highlighter-rouge">fig.height</code> : applies only to figures generated by R (not external images like PNGS, JPEGS, etc.)</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">out.width</code>, <code class="language-plaintext highlighter-rouge">out.height</code>: applies to external image files</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dpi</code> argument in <code class="language-plaintext highlighter-rouge">knitr::include_graphics()</code></p>
  </li>
</ul>]]></content><author><name>Jesse Cambon</name></author><category term="rmarkdown" /><summary type="html"><![CDATA[&lt;!–]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/images/xaringan.png" /><media:content medium="image" url="http://localhost:4000/images/xaringan.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Introducing Tidygeocoder 1.0.0</title><link href="http://localhost:4000/2020/07/15/tidygeocoder-1-0-0.html" rel="alternate" type="text/html" title="Introducing Tidygeocoder 1.0.0" /><published>2020-07-15T00:00:00-04:00</published><updated>2020-07-15T00:00:00-04:00</updated><id>http://localhost:4000/2020/07/15/tidygeocoder-1-0-0</id><content type="html" xml:base="http://localhost:4000/2020/07/15/tidygeocoder-1-0-0.html"><![CDATA[<p><a href="https://jessecambon.github.io/tidygeocoder/index.html">Tidygeocoder v1.0.0</a> is now live on CRAN. There are numerous new features and improvements such as batch geocoding (submitting multiple addresses per query), returning full results from geocoder services (not just latitude and longitude), address component arguments (city, country, etc.), query customization, and reduced package dependencies.</p>

<p>For a full list of new features and improvements refer to the <a href="https://github.com/jessecambon/tidygeocoder/releases/tag/v1.0.0">release page on Github</a>. For usage examples you can reference the <a href="https://jessecambon.github.io/tidygeocoder/articles/tidygeocoder.html">Getting Started vignette</a>.</p>

<p><img src="/../images/tidygeocoder_hex.png" width="200" style="display: block; margin: auto;" /></p>

<p>To demonstrate a few of the new capabilities of this package, I decided to make a map of the stadiums for the <a href="https://www.uefa.com/uefachampionsleague/draws/2020/2001141/">UEFA Champions League Round of 16 clubs</a>. To start, I looked up the addresses for the stadiums and put them in a dataframe.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidygeocoder</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">require</span><span class="p">(</span><span class="n">maps</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">

</span><span class="c1"># https://www.uefa.com/uefachampionsleague/clubs/</span><span class="w">
</span><span class="n">stadiums</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="o">::</span><span class="n">tribble</span><span class="p">(</span><span class="w">
</span><span class="o">~</span><span class="n">Club</span><span class="p">,</span><span class="w">                </span><span class="o">~</span><span class="n">Street</span><span class="p">,</span><span class="w">   </span><span class="o">~</span><span class="n">City</span><span class="p">,</span><span class="w">   </span><span class="o">~</span><span class="n">Country</span><span class="p">,</span><span class="w">
</span><span class="s2">"Barcelona"</span><span class="p">,</span><span class="w">          </span><span class="s2">"Camp Nou"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Barcelona"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Spain"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Bayern Munich"</span><span class="p">,</span><span class="w">      </span><span class="s2">"Allianz Arena"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Munich"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Germany"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Chelsea"</span><span class="p">,</span><span class="w">            </span><span class="s2">"Stamford Bridge"</span><span class="p">,</span><span class="w"> </span><span class="s2">"London"</span><span class="p">,</span><span class="w"> </span><span class="s2">"UK"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Borussia Dortmund"</span><span class="p">,</span><span class="w">  </span><span class="s2">"Signal Iduna Park"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Dortmund"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Germany"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Juventus"</span><span class="p">,</span><span class="w">           </span><span class="s2">"Allianz Stadium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Turin"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Italy"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Liverpool"</span><span class="p">,</span><span class="w">          </span><span class="s2">"Anfield"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Liverpool"</span><span class="p">,</span><span class="w"> </span><span class="s2">"UK"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Olympique Lyonnais"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Groupama Stadium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Lyon"</span><span class="p">,</span><span class="w"> </span><span class="s2">"France"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Man. City"</span><span class="p">,</span><span class="w">          </span><span class="s2">"Etihad Stadium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Manchester"</span><span class="p">,</span><span class="w"> </span><span class="s2">"UK"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Napoli"</span><span class="p">,</span><span class="w">             </span><span class="s2">"San Paolo Stadium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Naples"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Italy"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Real Madrid"</span><span class="p">,</span><span class="w">        </span><span class="s2">"Santiago Bernabéu Stadium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Madrid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Spain"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Tottenham"</span><span class="p">,</span><span class="w">          </span><span class="s2">"Tottenham Hotspur Stadium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"London"</span><span class="p">,</span><span class="w"> </span><span class="s2">"UK"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Valencia"</span><span class="p">,</span><span class="w">           </span><span class="s2">"Av. de Suècia, s/n, 46010"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Valencia"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Spain"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Atalanta"</span><span class="p">,</span><span class="w">           </span><span class="s2">"Gewiss Stadium"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Bergamo"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Italy"</span><span class="p">,</span><span class="w">
</span><span class="s2">"Atlético Madrid"</span><span class="p">,</span><span class="w">    </span><span class="s2">"Estadio Metropolitano"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Madrid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Spain"</span><span class="p">,</span><span class="w">
</span><span class="s2">"RB Leipzig"</span><span class="p">,</span><span class="w">         </span><span class="s2">"Red Bull Arena"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Leipzig"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Germany"</span><span class="p">,</span><span class="w">
</span><span class="s2">"PSG"</span><span class="p">,</span><span class="w">                </span><span class="s2">"Le Parc des Princes"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Paris"</span><span class="p">,</span><span class="w"> </span><span class="s2">"France"</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>To geocode these addresses, you can use the <a href="https://jessecambon.github.io/tidygeocoder/reference/geocode.html">geocode</a> function as shown below. New in v1.0.0, the <code class="language-plaintext highlighter-rouge">street</code>, <code class="language-plaintext highlighter-rouge">city</code>, and <code class="language-plaintext highlighter-rouge">country</code> arguments specify the address. The Nominatim (OSM) geocoder is selected with the <code class="language-plaintext highlighter-rouge">method</code> argument. Additionally, the <code class="language-plaintext highlighter-rouge">full_results</code> and <code class="language-plaintext highlighter-rouge">custom_query</code> arguments (also new in v1.0.0) are used to return the full geocoder results and set <a href="https://nominatim.org/release-docs/develop/api/Search/#parameters">Nominatim’s “extratags” parameter</a> which returns extra columns.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stadium_locations</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stadiums</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">geocode</span><span class="p">(</span><span class="n">street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Street</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">City</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Country</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'osm'</span><span class="p">,</span><span class="w"> 
          </span><span class="n">full_results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">custom_query</span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">extratags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>This returns 40 columns including the longitude and latitude. A few of the columns returned due to the <code class="language-plaintext highlighter-rouge">extratags</code> argument are shown below.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stadium_locations</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">Club</span><span class="p">,</span><span class="w"> </span><span class="n">City</span><span class="p">,</span><span class="w"> </span><span class="n">Country</span><span class="p">,</span><span class="w"> </span><span class="n">extratags.sport</span><span class="p">,</span><span class="w"> </span><span class="n">extratags.capacity</span><span class="p">,</span><span class="w"> </span><span class="n">extratags.operator</span><span class="p">,</span><span class="w"> </span><span class="n">extratags.wikipedia</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename_with</span><span class="p">(</span><span class="o">~</span><span class="n">gsub</span><span class="p">(</span><span class="s1">'extratags.'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Club</th>
      <th style="text-align: left">City</th>
      <th style="text-align: left">Country</th>
      <th style="text-align: left">sport</th>
      <th style="text-align: left">capacity</th>
      <th style="text-align: left">operator</th>
      <th style="text-align: left">wikipedia</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Barcelona</td>
      <td style="text-align: left">Barcelona</td>
      <td style="text-align: left">Spain</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">en:Camp Nou</td>
    </tr>
    <tr>
      <td style="text-align: left">Bayern Munich</td>
      <td style="text-align: left">Munich</td>
      <td style="text-align: left">Germany</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">75021</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">de:Allianz Arena</td>
    </tr>
    <tr>
      <td style="text-align: left">Chelsea</td>
      <td style="text-align: left">London</td>
      <td style="text-align: left">UK</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">41837</td>
      <td style="text-align: left">Chelsea Football Club</td>
      <td style="text-align: left">en:Stamford Bridge (stadium)</td>
    </tr>
    <tr>
      <td style="text-align: left">Borussia Dortmund</td>
      <td style="text-align: left">Dortmund</td>
      <td style="text-align: left">Germany</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">de:Signal Iduna Park</td>
    </tr>
    <tr>
      <td style="text-align: left">Juventus</td>
      <td style="text-align: left">Turin</td>
      <td style="text-align: left">Italy</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">it:Allianz Stadium (Torino)</td>
    </tr>
    <tr>
      <td style="text-align: left">Liverpool</td>
      <td style="text-align: left">Liverpool</td>
      <td style="text-align: left">UK</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">54074</td>
      <td style="text-align: left">Liverpool Football Club</td>
      <td style="text-align: left">en:Anfield</td>
    </tr>
    <tr>
      <td style="text-align: left">Olympique Lyonnais</td>
      <td style="text-align: left">Lyon</td>
      <td style="text-align: left">France</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">58000</td>
      <td style="text-align: left">Olympique Lyonnais</td>
      <td style="text-align: left">fr:Parc Olympique lyonnais</td>
    </tr>
    <tr>
      <td style="text-align: left">Man. City</td>
      <td style="text-align: left">Manchester</td>
      <td style="text-align: left">UK</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">Manchester City Football Club</td>
      <td style="text-align: left">en:City of Manchester Stadium</td>
    </tr>
    <tr>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">Naples</td>
      <td style="text-align: left">Italy</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">en:Stadio San Paolo</td>
    </tr>
    <tr>
      <td style="text-align: left">Real Madrid</td>
      <td style="text-align: left">Madrid</td>
      <td style="text-align: left">Spain</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">85454</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">es:Estadio Santiago Bernabéu</td>
    </tr>
    <tr>
      <td style="text-align: left">Tottenham</td>
      <td style="text-align: left">London</td>
      <td style="text-align: left">UK</td>
      <td style="text-align: left">soccer;american_football</td>
      <td style="text-align: left">62062</td>
      <td style="text-align: left">Tottenham Hotspur</td>
      <td style="text-align: left">en:Tottenham Hotspur Stadium</td>
    </tr>
    <tr>
      <td style="text-align: left">Valencia</td>
      <td style="text-align: left">Valencia</td>
      <td style="text-align: left">Spain</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
    </tr>
    <tr>
      <td style="text-align: left">Atalanta</td>
      <td style="text-align: left">Bergamo</td>
      <td style="text-align: left">Italy</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
    </tr>
    <tr>
      <td style="text-align: left">Atlético Madrid</td>
      <td style="text-align: left">Madrid</td>
      <td style="text-align: left">Spain</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">es:Estadio Metropolitano (Madrid)</td>
    </tr>
    <tr>
      <td style="text-align: left">RB Leipzig</td>
      <td style="text-align: left">Leipzig</td>
      <td style="text-align: left">Germany</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">NA</td>
      <td style="text-align: left">de:Red Bull Arena (Leipzig)</td>
    </tr>
    <tr>
      <td style="text-align: left">PSG</td>
      <td style="text-align: left">Paris</td>
      <td style="text-align: left">France</td>
      <td style="text-align: left">soccer</td>
      <td style="text-align: left">48527</td>
      <td style="text-align: left">Paris Saint-Germain</td>
      <td style="text-align: left">fr:Parc des Princes</td>
    </tr>
  </tbody>
</table>

<p>Below, the stadium locations are plotted on a map of Europe using the longitude and latitude coordinates and ggplot.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">stadium_locations</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">borders</span><span class="p">(</span><span class="s2">"world"</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">55</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_label_repel</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Club</span><span class="p">),</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">segment.alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_void</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/rmd_images/2020-07-15-tidygeocoder-1-0-0/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /></p>

<p>Alternatively, an interactive map can be created with the <a href="https://rstudio.github.io/leaflet/">leaflet</a> library:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">leaflet</span><span class="p">)</span><span class="w">

</span><span class="n">stadium_locations</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># Our dataset</span><span class="w">
  </span><span class="n">leaflet</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"100%"</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leafletOptions</span><span class="p">(</span><span class="n">attributionControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">setView</span><span class="p">(</span><span class="n">lng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">stadium_locations</span><span class="o">$</span><span class="n">long</span><span class="p">),</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">stadium_locations</span><span class="o">$</span><span class="n">lat</span><span class="p">),</span><span class="w"> </span><span class="n">zoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Map Backgrounds</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="n">providers</span><span class="o">$</span><span class="n">Stamen.Terrain</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Terrain"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="n">providers</span><span class="o">$</span><span class="n">NASAGIBS.ViirsEarthAtNight2012</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Night"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="n">providers</span><span class="o">$</span><span class="n">Stamen.Toner</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Stamen"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addTiles</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"OSM"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Add Markers</span><span class="w">
  </span><span class="n">addMarkers</span><span class="p">(</span><span class="w">
    </span><span class="n">labelOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labelOptions</span><span class="p">(</span><span class="n">noHide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">),</span><span class="w"> </span><span class="n">lng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">lat</span><span class="p">,</span><span class="w">
    </span><span class="n">clusterOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">markerClusterOptions</span><span class="p">(</span><span class="n">maxClusterRadius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">Club</span><span class="p">,</span><span class="w">
    </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Stadiums"</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Map Control Options</span><span class="w">
  </span><span class="n">addLayersControl</span><span class="p">(</span><span class="w">
    </span><span class="n">baseGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"OSM"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Stamen"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Terrain"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Night"</span><span class="p">),</span><span class="w">
    </span><span class="n">overlayGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Stadiums"</span><span class="p">),</span><span class="w">
    </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">layersControlOptions</span><span class="p">(</span><span class="n">collapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div id="htmlwidget-e070e6d717a54d5f5327" style="width:100%;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-e070e6d717a54d5f5327">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"attributionControl":false},"setView":[[46.816030234375,3.70195179384455],5,[]],"calls":[{"method":"addProviderTiles","args":["Stamen.Terrain",null,"Terrain",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["NASAGIBS.ViirsEarthAtNight2012",null,"Night",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Stamen.Toner",null,"Stamen",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"OSM",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[41.38089905,48.21880845,51.4816865,51.4928359,45.10965935,53.4308358,45.7653624,53.48309105,40.82797725,40.4530512,51.6041916,39.4756558,45.709222,40.43605295,51.34579105,48.8413634],[2.12292250075175,11.6246641517999,-0.191963664421104,7.45074465483453,7.64122132434347,-2.96090954141653,4.98205431107367,-2.20025200234333,14.1928889639353,-3.68754628942801,-0.0662349052591809,-0.3587826,9.68081336849461,-3.59971580972644,12.3482549226364,2.25306931623782],null,null,"Stadiums",{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,{"showCoverageOnHover":true,"zoomToBoundsOnClick":true,"spiderfyOnMaxZoom":true,"removeOutsideVisibleBounds":true,"spiderLegPolylineOptions":{"weight":1.5,"color":"#222","opacity":0.5},"freezeAtZoom":false,"maxClusterRadius":10},null,["Barcelona","Bayern Munich","Chelsea","Borussia Dortmund","Juventus","Liverpool","Olympique Lyonnais","Man. City","Napoli","Real Madrid","Tottenham","Valencia","Atalanta","Atlético Madrid","RB Leipzig","PSG"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["OSM","Stamen","Terrain","Night"],"Stadiums",{"collapsed":true,"autoZIndex":true,"position":"topright"}]}],"limits":{"lat":[39.4756558,53.48309105],"lng":[-3.68754628942801,14.1928889639353]}},"evals":[],"jsHooks":[]}</script>

<p><br /></p>

<p>If you find any issues with the package or have ideas on how to improve it, feel free to <a href="https://github.com/jessecambon/tidygeocoder/issues">file an issue on Github</a>. For reference, the R Markdown file that generated this blog post can be found <a href="https://github.com/jessecambon/jessecambon.github.io/tree/main/_posts/2020-07-15-tidygeocoder-1-0-0.Rmd">here</a>.</p>]]></content><author><name>Jesse Cambon</name></author><category term="r" /><category term="tidygeocoder" /><summary type="html"><![CDATA[Tidygeocoder v1.0.0 is now live on CRAN. There are numerous new features and improvements such as batch geocoding (submitting multiple addresses per query), returning full results from geocoder services (not just latitude and longitude), address component arguments (city, country, etc.), query customization, and reduced package dependencies.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/images/tidygeocoder_hex.png" /><media:content medium="image" url="http://localhost:4000/images/tidygeocoder_hex.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Deploying R Markdown Online</title><link href="http://localhost:4000/2020/03/22/deploying-rmarkdown-online.html" rel="alternate" type="text/html" title="Deploying R Markdown Online" /><published>2020-03-22T00:00:00-04:00</published><updated>2020-03-22T00:00:00-04:00</updated><id>http://localhost:4000/2020/03/22/deploying-rmarkdown-online</id><content type="html" xml:base="http://localhost:4000/2020/03/22/deploying-rmarkdown-online.html"><![CDATA[<p><a href="https://rmarkdown.rstudio.com/">R Markdown</a> is a great tool for creating a variety of documents with R code and it’s a natural choice for producing blog posts such as this one. However, depending on which blog software you use, you may run into some problems related to the file paths for figure images (such as <a href="https://ggplot2.tidyverse.org/">ggplot</a> charts) which will require tweaks in your R Markdown workflow.</p>

<p>This blog post demonstrates a simple solution to this problem that will also give you central control over R Markdown knit settings across your site. I use this solution for this blog and <a href="https://github.com/jessecambon/Data-Science-Codex">a GitHub repository of data science resources</a>. You can also find the R Markdown file that generated this blog post <a href="https://github.com/jessecambon/jessecambon.github.io/blob/master/_posts/2020-03-22-deploying-rmarkdown-online.Rmd">here</a>.</p>

<p><img src="/../images/hex-rmarkdown.png" style="display: block; margin: auto;" /></p>

<p>Note that in this post I will be talking about implementing a solution for a <a href="https://jekyllrb.com/">Jekyll</a> blog that is hosted via <a href="https://pages.github.com/">GitHub pages</a>. Some modifications may be required if you are using another blog or website platform. However, this solution should be adaptable to all blogs or websites that use Markdown.</p>

<p>For Jekyll there are two steps to building web content (HTML) from an R Markdown file. The first is to knit the R Markdown (.Rmd) file which creates the Markdown (.md) file. The second step is to use the <a href="https://jekyllrb.com/docs/usage/">jekyll build</a> command to create HTML content which is what will be displayed online.</p>

<pre>
1. <b>Knit:</b>          R Markdown (.Rmd) ----&gt;  Markdown (.md) 
2. <b>Jekyll Build:</b>  Markdown (.md)   ----&gt;  HTML (.html)
</pre>

<h2 id="the-problem">The Problem</h2>

<p>When I first used R Markdown to create a post for this blog, none of my figures showed up in the post. The issue was that <a href="https://jekyllrb.com/">Jekyll</a> creates the HTML file for a blog post in a different location than the R Markdown (.Rmd) and Markdown (.md) files and this breaks figure file paths. <a href="http://www.randigriffin.com/2017/04/25/how-to-knit-for-mysite.html">This blog post</a> describes the problem in more detail.</p>

<p>Also, by default R Markdown stores files for figures two folder levels deep using the R Markdown file location as its root (ie. <code class="language-plaintext highlighter-rouge">&lt;rmarkdown-filename&gt;_files/figure-gfm/image.png</code>). I find it more convenient to organize figure files in a separate root directory from my R Markdown files and store the images only one folder level deep (ie. <code class="language-plaintext highlighter-rouge">/rmd_images/&lt;rmarkdown-filename&gt;/image.png</code>). You can see this folder structure in action <a href="https://github.com/jessecambon/jessecambon.github.io">here</a> (posts are in the <code class="language-plaintext highlighter-rouge">_posts</code> folder and figures are in the <code class="language-plaintext highlighter-rouge">rmd_images</code> folder).</p>

<h2 id="the-solution">The Solution</h2>

<p>This solution uses a single R script file (.R) which contains knit settings adjustments and is referenced by all R Markdown (.Rmd) files. This allows you to edit knit settings in one central location and use these settings whenever you knit an R Markdown file. Modifications are made to the knit process so that figure image files are saved in a well organized folder structure and the HTML files display figures properly.</p>

<p>The contents of this central R script which I have named <a href="https://github.com/jessecambon/jessecambon.github.io/blob/master/rmd_config.R">rmd_config.R</a> is below. It lives in the root directory of my Github repository and the contents of this file will be run (via <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/source">source</a>) when each R Markdown file is knit.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get name of file during knitting and strip file extension</span><span class="w">
</span><span class="n">rmd_filename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stringr</span><span class="o">::</span><span class="n">str_remove</span><span class="p">(</span><span class="n">knitr</span><span class="o">::</span><span class="n">current_input</span><span class="p">(),</span><span class="w"> </span><span class="s2">"\\.Rmd"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Figure path on disk = base.dir + fig.path</span><span class="w">
</span><span class="c1"># Figure URL online = base.url + fig.path</span><span class="w">
</span><span class="n">knitr</span><span class="o">::</span><span class="n">opts_knit</span><span class="o">$</span><span class="n">set</span><span class="p">(</span><span class="n">base.dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringr</span><span class="o">::</span><span class="n">str_c</span><span class="p">(</span><span class="n">here</span><span class="o">::</span><span class="n">here</span><span class="p">(),</span><span class="w"> </span><span class="s2">"/"</span><span class="p">),</span><span class="w"> </span><span class="n">base.url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/"</span><span class="p">)</span><span class="w"> </span><span class="c1"># project root folder</span><span class="w">
</span><span class="n">knitr</span><span class="o">::</span><span class="n">opts_chunk</span><span class="o">$</span><span class="n">set</span><span class="p">(</span><span class="n">fig.path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringr</span><span class="o">::</span><span class="n">str_c</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="s2">"rmd_images"</span><span class="p">,</span><span class="w"> </span><span class="n">rmd_filename</span><span class="p">),</span><span class="w"> </span><span class="s2">"/"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Here is what is going on in the above script:</p>

<ul>
  <li>The filename of our R Markdown file is extracted using <code class="language-plaintext highlighter-rouge">knitr::current_input()</code> and stored in the variable <code class="language-plaintext highlighter-rouge">rmd_filename</code> (<code class="language-plaintext highlighter-rouge">str_remove</code> is used to remove the .Rmd file extension).</li>
  <li>The <a href="https://here.r-lib.org/">here package</a> establishes our ‘base’ directory (the root folder of our GitHub repository). The base directory path could change based on which computer we use and where we put our GitHub repository files so the here package allows us to automatically find this path.</li>
  <li>The <code class="language-plaintext highlighter-rouge">fig.path</code>, which is where our figures will be stored, is set to a folder named after the R Markdown file being run that resides in the ‘/rmd_images’ root directory.</li>
</ul>

<p>To utilize the above script in an R Markdown file, we simply insert the code below as a chunk into the R Markdown file. This will <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/source">source</a> the script to apply all the necessary knit settings when an R Markdown file is knit.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span><span class="p">(</span><span class="n">here</span><span class="o">::</span><span class="n">here</span><span class="p">(</span><span class="s2">"rmd_config.R"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>For a Jekyll blog, you’ll also want to include certain YAML header content such as tags or the title of the post. To do this we can use the <code class="language-plaintext highlighter-rouge">preserve_yaml</code> output setting in generating our .md file and then insert whatever YAML content we need into the header. Below is an example YAML header (the first part of your R Markdown document) which will generate a github-style (“gfm”) .md document. In this example I’ve added the fields “layout”, “title”, “date”, “author”, and “tags” which are all used by Jekyll in creating the blog post.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">---</span><span class="w">
</span><span class="n">layout</span><span class="o">:</span><span class="w"> </span><span class="n">post</span><span class="w">
</span><span class="n">title</span><span class="o">:</span><span class="w">  </span><span class="s2">"Deploying R Markdown Online"</span><span class="w">
</span><span class="n">date</span><span class="o">:</span><span class="w">   </span><span class="m">2020-03-22</span><span class="w">
</span><span class="n">author</span><span class="o">:</span><span class="w"> </span><span class="n">Jesse</span><span class="w"> </span><span class="n">Cambon</span><span class="w">
</span><span class="n">tags</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">output</span><span class="o">:</span><span class="w"> 
  </span><span class="n">md_document</span><span class="o">:</span><span class="w">
    </span><span class="n">pandoc_args</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"--wrap=none"</span><span class="p">]</span><span class="w">
    </span><span class="n">variant</span><span class="o">:</span><span class="w"> </span><span class="n">gfm</span><span class="w">
    </span><span class="n">preserve_yaml</span><span class="o">:</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
</span><span class="o">---</span><span class="w">
</span></code></pre></div></div>

<p>Note that the <code class="language-plaintext highlighter-rouge">pandoc_args</code> setting is to prevent the knit process from inserting extra line breaks into the Markdown file that don’t exist in our R Markdown file. The extra line breaks normally are invisible, but I found they showed up when I pushed content to <a href="https://www.r-bloggers.com/">R-Bloggers</a> which caused paragraphs to be broken up.</p>

<p>One other note on Jekyll is that it uses the <a href="https://jekyllrb.com/docs/liquid/">liquid template language</a>. If you want to display characters on your blog that are used by liquid such as <code class="language-plaintext highlighter-rouge">{{}}</code> (R’s “curly-curly” operator) then you will need to wrap these problematic characters with the <code class="language-plaintext highlighter-rouge">raw</code> and <code class="language-plaintext highlighter-rouge">endraw</code> liquid tags <a href="https://shopify.github.io/liquid/tags/raw/">as described here</a>. This prevents Jekyll from attempting to parse these characters as liquid syntax and passes them on in raw form to the HTML file for display.</p>

<h2 id="conclusion">Conclusion</h2>

<p>To see this solution in action, you can look at the GitHub repository that produces this blog <a href="https://github.com/jessecambon/jessecambon.github.io">here</a> and the R Markdown file for this specific blog post <a href="https://github.com/jessecambon/jessecambon.github.io/blob/master/_posts/2020-03-22-deploying-rmarkdown-online.Rmd">here</a>. To provide a self-contained example of a figure displaying, I’ve created a simple histogram plot below and you’ll find the image file neatly filed away in the <code class="language-plaintext highlighter-rouge">rmd_images</code> directory underneath a subfolder named after this blog post.</p>

<p>One caveat is that this approach does assume that each R Markdown filename is unique. If this is not the case then you’ll need to make some modifications to the central <code class="language-plaintext highlighter-rouge">rmd_config.R</code> file above; otherwise figure images from different R Markdown files may save in the same directory (and possibly overwrite each other). However, the solution described here is quite flexible and could be adapted to a variety of use cases with tweaks to the <code class="language-plaintext highlighter-rouge">rmd_config.R</code> file.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hist</span><span class="p">(</span><span class="n">mtcars</span><span class="o">$</span><span class="n">disp</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/rmd_images/2020-03-22-deploying-rmarkdown-online/sampleplot-1.png" alt="" /><!-- --></p>

<p><em><sub> March 26 2021: this post has been updated with simplified R Markdown code. </sub></em></p>]]></content><author><name>Jesse Cambon</name></author><category term="r" /><summary type="html"><![CDATA[R Markdown is a great tool for creating a variety of documents with R code and it’s a natural choice for producing blog posts such as this one. However, depending on which blog software you use, you may run into some problems related to the file paths for figure images (such as ggplot charts) which will require tweaks in your R Markdown workflow.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/images/hex-rmarkdown.png" /><media:content medium="image" url="http://localhost:4000/images/hex-rmarkdown.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>