<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Deploying RMarkdown Online | jessecambon</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="Deploying RMarkdown Online" />
<meta name="author" content="Jesse Cambon" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Problem" />
<meta property="og:description" content="The Problem" />
<link rel="canonical" href="http://localhost:4000/2020/01/12/deploying-rmarkdown.html" />
<meta property="og:url" content="http://localhost:4000/2020/01/12/deploying-rmarkdown.html" />
<meta property="og:site_name" content="jessecambon" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-01-12T00:00:00-05:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Deploying RMarkdown Online","url":"http://localhost:4000/2020/01/12/deploying-rmarkdown.html","datePublished":"2020-01-12T00:00:00-05:00","dateModified":"2020-01-12T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/01/12/deploying-rmarkdown.html"},"author":{"@type":"Person","name":"Jesse Cambon"},"description":"The Problem","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="jessecambon" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">jessecambon</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Deploying RMarkdown Online</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-01-12T00:00:00-05:00" itemprop="datePublished">Jan 12, 2020
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Jesse Cambon</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="the-problem">The Problem</h2>

<p>RMarkdown is powerful tool for creating documents with R code and it’s a natural choice for creating blog posts about R, such as this one. However, depending on which blog software you use, you may need to make tweaks to your RMarkdown documents to deploy them successfully.</p>

<p>For example, when I first used RMarkdown to create a post for this <a href="https://jekyllrb.com/">Jekyll</a> blog, none of my figures (images) showed up. The issue was that my Jekyll creates an HTML file in a different location than my RMarkdown (.Rmd) and Markdown (.md) files to host the content which breaks all the relative figure paths in the Markdown file. <a href="http://www.randigriffin.com/2017/04/25/how-to-knit-for-mysite.html">This blog post</a> describes the problem in more detail.</p>

<p>This blog post demonstrates a simple solution to this problem that I use for this blog and a GitHub repository. This solution uses a single script file (.R) which contains RMarkdown settings adjustments and is referenced from all RMarkdown (.Rmd) files. It will also allow you to control where RMarkdown saves your figure files.</p>

<p>By default RMarkdown stores figure images two folder levels deep using the RMarkdown file location as its root (ie. <code class="highlighter-rouge">rmdname_files/figure-gfm/image.png</code>). I find it more conveniant to organize figure images in a separate root directory from my RMarkdown scripts and use folder names that match the name of my RMarkdown file after the RMarkdown file that generated them (ie. <code class="highlighter-rouge">rmd_images/&lt;rmarkdown-filename&gt;/image.png</code>).</p>

<h2 id="the-workflow">The Workflow</h2>

<p>Note that for the purposes of this post I will be talking about the implementation on a Jekyll blog and some modifications may be required if you are using another blog platform.</p>

<p>For Jekyll there are two steps to building web content with an RMarkdown file. The first is to knit the RMarkdown (.Rmd) file which creates the Markdown (.md) file. The second step is to use the <a href="https://jekyllrb.com/docs/usage/">jekyll build</a> command to create HTML content which is what will be displayed online.</p>

<p>Steps:</p>

<blockquote>
  <ol>
    <li><strong>Knit:</strong> Rmarkdown (.Rmd) —-&gt; Markdown (.md)</li>
    <li><strong>Jekyll Build:</strong> Markdown (.md) —-&gt; HTML (.html)</li>
  </ol>
</blockquote>

<h2 id="the-solution">The Solution</h2>

<p>This solution makes some modifications to the first step (knit) so that figure image files are well organized and the HTML files display the images properly. We will use a central R script (.R) to configure RMarkdown to have customizable figure image locations and to generate figure paths that will work once our content is pushed to a GitHub repository or blog.</p>

<p>The following is the contents of this central R Script which I have named <strong>rmd_config.R</strong> and placed in the root directory of my GitHub repository:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">here</span><span class="p">)</span><span class="w">
</span><span class="c1"># get name of file during knitting and strip file extension</span><span class="w">
</span><span class="n">rmd_filename</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_remove</span><span class="p">(</span><span class="n">knitr</span><span class="o">::</span><span class="n">current_input</span><span class="p">(),</span><span class="s2">"\\.Rmd"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Figure path on disk = base.dir + fig.path</span><span class="w">
</span><span class="c1"># Figure URL online = base.url + fig.path</span><span class="w">
</span><span class="n">knitr</span><span class="o">::</span><span class="n">opts_knit</span><span class="o">$</span><span class="n">set</span><span class="p">(</span><span class="n">base.dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_c</span><span class="p">(</span><span class="n">here</span><span class="o">::</span><span class="n">here</span><span class="p">(),</span><span class="s1">'/'</span><span class="p">),</span><span class="n">base.url</span><span class="o">=</span><span class="s1">'/'</span><span class="p">)</span><span class="w"> </span><span class="c1"># project root folder</span><span class="w">
</span><span class="n">knitr</span><span class="o">::</span><span class="n">opts_chunk</span><span class="o">$</span><span class="n">set</span><span class="p">(</span><span class="n">fig.path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_c</span><span class="p">(</span><span class="s2">"rmd_images/"</span><span class="p">,</span><span class="n">rmd_filename</span><span class="p">,</span><span class="s1">'/'</span><span class="p">),</span><span class="n">echo</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Here is what is going on in the above script:</p>

<ul>
  <li>The filename of our RMarkdown script is extracted using <code class="highlighter-rouge">knitr</code> and <code class="highlighter-rouge">str_remove</code> and stored in the variable <code class="highlighter-rouge">rmd_filename</code>.</li>
  <li>The <a href="https://here.r-lib.org/">here package</a> is used to establish our ‘base’ directory (the root folder of our GitHub repository). Since this could change based on what local system we are on, the here package allows us to automatically compensate for what root path we are in.</li>
  <li>The <code class="highlighter-rouge">fig.path</code>, which is where our figures will be stored, is set to a folder named after the RMarkdown file being run that resides in the ‘rmd_image’ root directory.</li>
</ul>

<p>To utilize this above script in an RMarkdown file, we simple insert this chunk which will source the script to apply all the necessary RMarkdown settings:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">here</span><span class="p">)</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="n">here</span><span class="o">::</span><span class="n">here</span><span class="p">(</span><span class="s2">"rmd_config.R"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>If you’re using Jekyll for your blog, you’ll also want to include certain YAML header content such as tags or the title of the post. To do this we can use the <code class="highlighter-rouge">preserve_yaml</code> setting in generating our .md file and then insert whatever yaml content we need into the header. Here is an example YAML header (the first part of your RMarkdown document) which will generate a github-style (“gfm”) .md document:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">---</span><span class="w">
</span><span class="n">layout</span><span class="o">:</span><span class="w"> </span><span class="n">post</span><span class="w">
</span><span class="n">title</span><span class="o">:</span><span class="w">  </span><span class="s2">"Deploying RMarkdown Online"</span><span class="w">
</span><span class="n">date</span><span class="o">:</span><span class="w">   </span><span class="m">2020-1-12</span><span class="w">
</span><span class="n">author</span><span class="o">:</span><span class="w"> </span><span class="n">Jesse</span><span class="w"> </span><span class="n">Cambon</span><span class="w">
</span><span class="n">tags</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">rmarkdown</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">-</span><span class="n">science</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">output</span><span class="o">:</span><span class="w"> 
  </span><span class="n">md_document</span><span class="o">:</span><span class="w">
    </span><span class="n">pandoc_args</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"--wrap=none"</span><span class="p">]</span><span class="w">
    </span><span class="n">variant</span><span class="o">:</span><span class="w"> </span><span class="n">gfm</span><span class="w">
    </span><span class="n">preserve_yaml</span><span class="o">:</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
</span><span class="o">---</span><span class="w">
</span></code></pre></div></div>

<p>Note that the ‘pandoc_args’ setting is to prevent pandoc from inserting extra linebreaks that don’t exist in our RMarkdown file.</p>

<p>One other note about Jekyll is that it uses <a href="https://jekyllrb.com/docs/liquid/">liquid markdown</a>. This normally is not something that causes any issues, but if you want to display characters on your blog that are used by the liquid template such as `` (R’s “curly-curly” operator) then you will need to wrap these problematic characters like this: <code class="highlighter-rouge">{{}}</code>. This prevents Jekyll from attempting to parse these characters as liquid syntax and they will be passed on in raw form to the HTML file for display.</p>

<h2 id="conclusion">Conclusion</h2>

<p>&lt;&gt;</p>

  </div><a class="u-url" href="/2020/01/12/deploying-rmarkdown.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>
  <div class="wrapper">
    <div class="social-links"><ul class="social-media-list"><li><a href="https://github.com/jessecambon"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jessecambon</span></a></li><li><a href="https://www.linkedin.com/in/jessecambon"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">jessecambon</span></a></li></ul>
</div>
  </div>
</footer></body>

</html>
