---
layout: post
title:  "Quasiquotation Demo"
date:   2019-11-18
tags: test
output: 
  md_document:
    variant: gfm
    preserve_yaml: TRUE
---


```{r setup, include=FALSE}
library(here)
source(here::here("rmd_config.R"))
```

Creating a basic function

```{r}
library(dplyr)
# Get top x rows after sorting by variable var
get_stats <- function(data,group_var,measure_var) {
  measure_name <- quo_name(enquo(measure_var))
  return( 
    data %>% group_by({{group_var}}) %>%
            summarize( !!str_c(measure_name,"_max") := max({{measure_var}}),
                       !!str_c(measure_name,"_min") := min({{measure_var}})) 
    )
}

cyl_hp_stats <- mtcars %>% get_stats(cyl,hp)
```


```{r}
kable(cyl_hp_stats)
```


Creating a function with a list argument. Return mean horsepower with a list of group by variables.

```{r}
hp_calc <- function(data,group_vars,measure_var) {
  group_vars <- rlang::syms(group_vars)
  return(data %>% group_by(!!!group_vars) %>%
           summarize(n=n(),
                     variable=quo_name(enquo(measure_var)),
                     mean=mean({{measure_var}}),
                     min=min({{measure_var}}),
                     max=max({{measure_var}}))
  )
}
 
gear_hp <- mtcars %>% hp_calc(c('gear'),hp) 
vs_am_hp <- mtcars %>% hp_calc(c('vs','am'),cyl) 
```

```{r}
kable(gear_hp)
kable(vs_am_hp)
```

```{r}
library(ggplot2)
ggplot(data=gear_hp) + geom_point(aes(x=gear,y=mean)) + 
  theme_classic() + ylab('Mean HP')
```

